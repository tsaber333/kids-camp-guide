<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foursquare Kids Camp - Interactive Leader's Guide</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E⛺%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Marked.js for Markdown parsing -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base font and general layout */
        body { font-family: 'Inter', sans-serif; }
        
        /* Chart container styling for responsiveness */
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 350px; 
            margin-left: auto; 
            margin-right: auto; 
            height: 350px; /* Fixed height for chart area */
        }

        /* Modal overlay and content display */
        .modal { 
            display: none; /* Hidden by default */
        }
        .modal.active { 
            display: flex; /* Flexbox for centering when active */
        }

        /* Card entry animation */
        .card-enter {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        .card-enter-active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom scrollbar for modals for better UX */
        .modal-content-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .modal-content-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .modal-content-scroll::-webkit-scrollbar-thumb:hover {
            background: #555;
            }

        /* Collapsible section styles */
        .collapsible-content {
            /* Increased max-height to ensure content is not cut off */
            max-height: 3000px; /* Arbitrarily large value to allow smooth transition */
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
            opacity: 1;
        }
        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
        }
        /* Icon rotation for collapsible section */
        .collapse-icon {
            display: inline-block; /* Essential for transform to work reliably on span */
            transition: transform 0.3s ease-out;
            transform: rotate(90deg); /* Default state (OPEN): points DOWN (because the base icon is a right arrow) */
        }
        .collapse-icon.collapsed {
            transform: rotate(0deg); /* When collapsed (CLOSED): points RIGHT (because the base icon is a right arrow) */
        }

        /* Calendar specific styles */
        .calendar-grid {
            display: grid;
            /* 100px for time column + 7 activity columns */
            /* Adjusted minmax to allow columns to shrink more, forcing wrap */
            grid-template-columns: 100px repeat(7, minmax(80px, 1fr)); /* Reduced min-width for activity columns */
            gap: 1px; /* Thin lines between cells */
            background-color: #e5e7eb; /* Light gray for grid lines */
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden; /* Ensures rounded corners apply correctly */
            /* Added min-width to ensure the grid can expand beyond container, enabling horizontal scroll */
            min-width: 667px; /* 100px (time) + 7*80px (min activity) + 7*1px (gap) */
        }

        .calendar-header, .calendar-time-slot, .calendar-slot {
            background-color: #ffffff; /* White background for cells */
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #44403c; /* stone-700 */
        }

        .calendar-header {
            background-color: #f5f5f4; /* stone-100 */
            font-weight: 600; /* font-semibold */
            color: #14532d; /* emerald-800 */
            font-size: 0.75rem; /* Smaller font for headers */
        }

        .calendar-time-slot {
            background-color: #f5f5f4; /* stone-100 */
            font-weight: 600; /* font-semibold */
            color: #14532d; /* emerald-800 */
            justify-content: flex-start; /* Align time to left */
            padding-left: 1rem;
            font-size: 0.75rem; /* Smaller font for time slots */
        }

        .calendar-slot {
            min-height: 70px; /* Ensure enough height for content, slightly increased */
            flex-direction: column; /* Stack dropped items vertically */
            gap: 0.25rem; /* Space between dropped items */
            position: relative; /* For positioning remove button */
            white-space: normal; /* Allow text to wrap naturally */
            word-break: break-word; /* Force words to break if they are too long for the container */
        }

        .calendar-slot.droppable {
            background-color: #ffffff; /* White for droppable slots */
        }

        .calendar-slot.non-droppable {
            background-color: #d6d3d1; /* stone-300 for non-droppable slots */
            color: #44403c; /* stone-700 */
            cursor: not-allowed;
            font-weight: 500;
            font-size: 0.875rem; /* text-sm - Increased for better visibility of team names */
            white-space: normal; /* Allow text to wrap for team names */
            overflow: visible; /* Ensure text is not hidden */
            text-overflow: clip; /* Prevent ellipsis on wrapped text */
        }

        /* Styling for selected activity card */
        .game-card.selected {
            border: 3px solid #065f46; /* emerald-800 */
            box-shadow: 0 0 15px rgba(6, 95, 70, 0.4); /* Green glow */
        }

        /* Styling for calendar slot when an activity is selected */
        .calendar-slot.droppable.highlight-drop {
            background-color: #d1fae5; /* emerald-100 */
            border: 2px dashed #065f46; /* emerald-800 dashed border */
        }
        .calendar-slot.droppable.invalid-drop {
            background-color: #fee2e2; /* red-100 */
            border: 2px dashed #dc2626; /* red-600 dashed border */
        }


        .scheduled-activity-item {
            background-color: #d1fae5; /* emerald-100 */
            color: #065f46; /* emerald-800 */
            font-size: 0.875rem; /* text-sm - Increased for better visibility */
            font-weight: 600; /* font-semibold */
            padding: 0.35rem 0.6rem; /* Slightly more padding */
            border-radius: 0.375rem; /* rounded-md */
            width: 100%;
            white-space: normal; /* Allow text to wrap */
            cursor: grab; /* Indicate draggable */
            position: relative;
            word-break: break-word; /* Force words to break if they are too long for the container */
        }

        .scheduled-activity-item .remove-scheduled-activity {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444; /* red-500 */
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            cursor: pointer;
            line-height: 1;
            border: 1px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            opacity: 0; /* Hidden by default */
            transition: opacity 0.2s ease-in-out;
        }

        .scheduled-activity-item:hover .remove-scheduled-activity {
            opacity: 1; /* Show on hover */
        }

        /* Team Colors - Made more distinct */
        .team-1 { color: #b91c1c; font-weight: bold; font-size: 0.875rem; } /* red-700 */
        .team-2 { color: #1d4ed8; font-weight: bold; font-size: 0.875rem; } /* blue-700 */
        .team-3 { color: #0f766e; font-weight: bold; font-size: 0.875rem; } /* teal-700 */
        .team-4 { color: #7e22ce; font-weight: bold; font-size: 0.875rem; } /* purple-700 */
        .team-5 { color: #c2410c; font-weight: bold; font-size: 0.875rem; } /* orange-700 */
        .team-6 { color: #4338ca; font-weight: bold; font-size: 0.875rem; } /* indigo-700 */
        .team-7 { color: #be185d; font-weight: bold; font-size: 0.875rem; } /* pink-700 */
        .team-8 { color: #047857; font-weight: bold; font-size: 0.875rem; } /* emerald-700 */

        /* Added for modal text content wrapping */
        .modal-text-content p, .modal-text-content li {
            white-space: normal;
            word-break: break-word;
        }

    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <!-- Main application container -->
    <div id="app-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Header section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-700">Foursquare Kids Camp</h1>
            <p class="mt-4 text-lg text-stone-600">Interactive Leader's Guide</p>
        </header>

        <!-- Main content area -->
        <main>
            <!-- Dashboard section with welcome message and activity overview chart -->
            <section id="dashboard" class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 items-center">
                    <div class="lg:col-span-2">
                        <h2 class="text-2xl font-bold text-teal-700 mb-2">Welcome, Camp Leaders!</h2>
                        <p class="text-stone-600">
                            This guide is your central hub for planning and leading activities. Use the filters below to quickly find the perfect game for your next slot, whether you're on the field or need an indoor option for a rainy day. Each game card provides a full breakdown of instructions, materials, and key discussion points to connect with our camp's mission.
                        </p>
                        <div class="flex flex-wrap gap-3 mt-4">
                            <!-- Button to view deleted activities -->
                            <button id="view-deleted-activities-btn" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors text-sm">
                                View Deleted Activities (<span id="deleted-count">0</span>)
                            </button>
                            <!-- Button to populate initial games -->
                            <button id="populate-initial-games-btn" class="bg-emerald-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-emerald-600 transition-colors text-sm">
                                Populate Initial Games
                            </button>
                        </div>
                    </div>
                    <!-- Doughnut chart for activity type distribution -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                        <h3 class="text-xl font-bold text-center text-teal-700 mb-4">Activity Overview</h3>
                        <div class="chart-container" style="height: 150px; max-width: 150px;">
                            <canvas id="activityTypeChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Leader Resources & Best Practices collapsible section - Moved Up -->
            <section id="leader-resources" class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                <div class="flex justify-between items-center cursor-pointer" id="leader-resources-toggle">
                    <h2 class="text-2xl font-bold text-teal-700 mb-4">Leader Resources & Best Practices</h2>
                    <button class="text-stone-500 hover:text-teal-600 transition-colors">
                        <span class="text-2xl font-bold collapse-icon">&#x25B6;</span> <!-- Right arrow icon -->
                    </button>
                </div>
                <div id="leader-resources-content" class="collapsible-content collapsed">
                    <p class="text-stone-600 mb-4">
                        This section provides essential guidance to help you make the most of this interactive guide and ensure a successful, safe, and spiritually impactful activity time for your campers.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-bold text-teal-700 mb-2">Navigating This Guide</h3>
                            <ul class="list-disc list-inside text-stone-700 space-y-2">
                                <li>**Filtering Activities:** Use the "Filter by Type," "Filter by Location," and "Filter by Materials" to quickly narrow down game options. Select "All" to see the full list again.</li>
                                <li>**Viewing Details:** Click on any activity card to open a detailed modal. This modal contains objectives, step-by-step instructions, a comprehensive materials list, crucial safety notes, and the "SuperCharged Application."</li>
                                <li>**Material Check:** Always review the "Materials Needed" section well in advance of your activity time to ensure all supplies are readily available.</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-teal-700 mb-2">Leading Activities Effectively</h3>
                            <ul class="list-disc list-inside text-stone-700 space-y-2">
                                <li>**Safety First:** Prioritize the "Safety Notes" for each game. Conduct a quick safety check of the play area and equipment before starting.</li>
                                <li>**Clear Instructions:** Explain game rules clearly and concisely. Demonstrate if possible. Encourage questions before starting.</li>
                                <li>**Adapt & Modify:** Feel free to adapt games to suit your group's size, age, energy levels, or available space.</li>
                                <li>**Encourage Participation:** Create an inclusive environment where every camper feels comfortable participating and trying their best.</li>
                                <li>**Time Management:** Keep an eye on the clock to ensure you have enough time for the activity itself and, crucially, for the debriefing.</li>
                            </ul>
                        </div>
                        <div class="md:col-span-2">
                            <h3 class="text-xl font-bold text-teal-700 mb-2">Maximizing the "SuperCharged Application"</h3>
                            <p class="text-stone-700">
                                The "SuperCharged Application" is key to connecting our activities with the spiritual growth of our campers. This section provides prompts and ideas to help you facilitate meaningful discussions after each game.
                            </p>
                            <ul class="list-disc list-inside text-stone-700 space-y-2 mt-2">
                                <li>**Purpose:** This is where we bridge the fun of the game to life lessons and Foursquare values.</li>
                                <li>**Timing:** Always debrief immediately after the game, while the experience is fresh in their minds.</li>
                                <li>**Open-Ended Questions:** Use the suggested questions as a starting point. Encourage honest sharing and active listening among campers.</li>
                                <li>**Connect to Scripture/Values:** Help campers see how the game's lessons relate to Bible principles or the Foursquare values (e.g., 'Jesus the Savior, Healer, Baptizer with the Holy Spirit, and Soon-Coming King').</li>
                                <li>**Personal Reflection:** Encourage campers to think about how they can apply these lessons in their daily lives.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Activity Management Instructions collapsible section - Moved Up -->
            <section id="activity-management-instructions" class="mb-8 bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                <div class="flex justify-between items-center cursor-pointer" id="activity-management-toggle">
                    <h2 class="text-2xl font-bold text-teal-700 mb-4">Activity Management Instructions</h2>
                    <button class="text-stone-500 hover:text-teal-600 transition-colors">
                        <span class="text-2xl font-bold collapse-icon">&#x25B6;</span>
                    </button>
                </div>
                <div id="activity-management-content" class="collapsible-content collapsed">
                    <p class="text-stone-600 mb-4">
                        This section explains how to add new activities to your guide and manage existing ones, including moving them to trash and permanently deleting them.
                    </p>
                    <ul class="list-disc list-inside text-stone-700 space-y-2">
                        <li>**Adding a New Activity:**
                            <ul class="list-circle list-inside ml-4">
                                <li>Click the "**Add New Activity**" card at the bottom of the "Find an Activity" section.</li>
                                <li>Fill out the form with all required details (marked with *).</li>
                                <li>Choose between "General Instructions" (a list of steps) or "Station-Based Instructions" (for activities with multiple distinct stations, like "Minute to Win It Mayhem").</li>
                                <li>Click "Add Activity" to save your new activity to the guide. It will appear in your activity list.</li>
                            </ul>
                        </li>
                        <li>**Editing an Existing Activity:**
                            <ul class="list-circle list-inside ml-4">
                                <li>Click on any activity card to open its "Activity Details" modal.</li>
                                <li>At the bottom of the modal, click the "**Edit Activity**" button.</li>
                                <li>The "Add/Edit Activity" form will open, pre-filled with the activity's current information.</li>
                                <li>Make your desired changes and click "Save Changes" to update the activity.</li>
                            </ul>
                        </li>
                        <li>**Moving an Activity to Trash (Soft Delete):**
                            <ul class="list-circle list-inside ml-4">
                                <li>Click on any activity card to open its "Activity Details" modal.</li>
                                <li>At the bottom of the modal, click the "**Move to Trash**" button.</li>
                                <li>The activity will be removed from your main list but can still be restored later.</li>
                            </ul>
                        </li>
                        <li>**Viewing and Restoring Deleted Activities:**
                            <ul class="list-circle list-inside ml-4">
                                <li>On the dashboard, click the "**View Deleted Activities**" button.</li>
                                <li>A modal will appear showing all activities you've moved to trash.</li>
                                <li>To bring an activity back to your main list, click its "**Restore**" button.</li>
                                <li>
                                    **Important:**
                                    If you restore an activity, it will appear back in the main list, but if it was previously scheduled on the calendar, it will *not* automatically reappear on the calendar. You will need to click and add it onto the calendar again.
                                </li>
                            </ul>
                        </li>
                        <li>**Permanently Deleting an Activity:**
                            <ul class="list-circle list-inside ml-4">
                                <li>From the "View Deleted Activities" modal, locate the activity you wish to permanently remove.</li>
                                <li>Click its "**Delete Permanently**" button.</li>
                                <li>A confirmation dialog will appear. Confirm your choice to permanently remove the activity from the database. This action cannot be undone.</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </section>
            
            <!-- Activity Finder section with filters and game grid -->
            <section id="activity-finder" class="flex-grow bg-white p-6 rounded-xl shadow-sm border border-stone-200 mb-8 overflow-y-auto">
                <h2 class="text-2xl font-bold text-teal-700 mb-4">Find an Activity</h2>
                <div class="flex flex-wrap gap-4 items-center mb-6">
                    <!-- Type filters (Field Game, Team Time) -->
                    <div>
                        <label class="font-bold text-stone-700">Filter by Type:</label>
                        <div id="type-filters" class="flex flex-wrap gap-2 mt-2">
                            <button class="filter-btn-type bg-teal-600 text-white py-2 px-4 rounded-full" data-type="all">All</button>
                            <button class="filter-btn-type bg-stone-200 text-stone-700 py-2 px-4 rounded-full" data-type="Field Game">Field Games</button>
                            <button class="filter-btn-type bg-stone-200 text-stone-700 py-2 px-4 rounded-full" data-type="Team Time">Team Time</button>
                        </div>
                    </div>
                    <!-- Location filters (Outdoor, Indoor, Both) -->
                     <div>
                        <label class="font-bold text-stone-700">Filter by Location:</label>
                        <div id="location-filters" class="flex flex-wrap gap-2 mt-2">
                            <button class="filter-btn-location bg-teal-600 text-white py-2 px-4 rounded-full" data-location="all">All</button>
                            <button class="filter-btn-location bg-stone-200 text-stone-700 py-2 px-4 rounded-full" data-location="Outdoor">Outdoor</button>
                            <button class="filter-btn-location bg-stone-200 text-stone-700 py-2 px-4 rounded-full" data-location="Indoor">Indoor</button>
                            <button class="filter-btn-location bg-stone-200 text-stone-700 py-2 px-4 rounded-full" data-location="Both">Both</button>
                        </div>
                    </div>
                    <!-- Material filter dropdown -->
                    <div>
                        <label for="material-filter-select" class="font-bold text-stone-700">Filter by Material:</label>
                        <select id="material-filter-select" class="mt-2 block w-full pl-3 pr-10 py-2 text-base border-stone-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                            <option value="all">All Materials</option>
                            <!-- Options will be dynamically populated here by JavaScript -->
                        </select>
                    </div>
                </div>

                <!-- Grid to display activity cards -->
                <div id="game-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Loading indicator for activities -->
                    <div id="loading-indicator" class="col-span-full text-center text-stone-500 text-lg py-8">Loading activities...</div>
                </div>
            </section>

            <!-- Camp Schedule Calendar Section -->
            <section id="camp-schedule" class="bg-white p-6 rounded-xl shadow-sm border border-stone-200 mb-8">
                <h2 class="text-2xl font-bold text-teal-700 mb-4">Camp Schedule</h2>
                
                <!-- Calendar Instructions Collapsible Section -->
                <div id="calendar-instructions" class="mb-6 bg-stone-50 p-4 rounded-lg border border-stone-200">
                    <div class="flex justify-between items-center cursor-pointer" id="calendar-instructions-toggle">
                        <h3 class="text-xl font-bold text-teal-700">How to Use the Schedule</h3>
                        <button class="text-stone-500 hover:text-teal-600 transition-colors">
                            <span class="text-xl font-bold collapse-icon">&#x25B6;</span>
                        </button>
                    </div>
                    <div id="calendar-instructions-content" class="collapsible-content collapsed">
                        <ul class="list-disc list-inside text-stone-700 space-y-2 mt-4">
                            <li>**Select an Activity:** Click on any activity card in the "Find an Activity" section above to select it. The selected card will be highlighted with a green border.</li>
                            <li>**Add to Schedule:** Once an activity is selected, the calendar slots will change color to guide you:
                                <ul class="list-circle list-inside ml-4 mt-2">
                                    <li><span class="font-semibold text-emerald-700">Green Highlighted Slots:</span> These are valid 'addable' slots where the selected activity can be placed (e.g., a "Field Game" into a "FIELD" slot, or a "Team Time" activity into a "TEAM TIME" slot). Click on a green slot to add the activity.</li>
                                    <li><span class="font-semibold text-red-700">Red Highlighted Slots:</span> These slots are 'invalid' for the currently selected activity type. You cannot add the activity here.</li>
                                    <li><span class="font-semibold text-stone-700">Gray Slots:</span> These slots are 'non-addable' and are already pre-assigned with specific teams or are blocked out. You cannot add activities into these.</li>
                                </ul>
                            </li>
                            <li>**Remove Scheduled Activities:** To remove an activity you've scheduled, hover over the activity name in the calendar slot and click the small 'x' button that appears.</li>
                            <li>**Real-time Updates:** Any changes you make to the schedule (adding or removing activities) will be saved automatically and updated in real-time.</li>
                        </ul>
                    </div>
                </div>

                <div id="calendar-grid-container" class="overflow-x-auto">
                    <div class="calendar-grid">
                        <!-- Calendar grid will be dynamically generated here by JavaScript -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Game Details Modal (displays full information about an activity) -->
    <div id="game-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto modal-content-scroll">
            <div class="sticky top-0 bg-white p-4 sm:p-6 border-b border-stone-200 flex justify-between items-center">
                <h2 id="modal-title" class="text-2xl sm:text-3xl font-bold text-teal-700"></h2>
                <button id="close-modal" class="text-stone-500 hover:text-red-600 transition-colors">
                    <span class="text-2xl font-bold">&times;</span>
                </button>
            </div>
            <div id="modal-content" class="p-4 sm:p-6 modal-text-content">
            </div>
            <div class="p-4 sm:p-6 border-t border-stone-200 flex justify-end gap-3">
                <!-- Button to edit an activity -->
                <button id="edit-activity-btn" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                    Edit Activity
                </button>
                <!-- Button to soft-delete an activity -->
                <button id="move-to-trash-btn" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors text-sm">
                    Move to Trash
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Activity Modal (form for creating new activities) -->
    <div id="activity-form-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto modal-content-scroll">
            <div class="sticky top-0 bg-white p-4 sm:p-6 border-b border-stone-200 flex justify-between items-center">
                <h2 id="activity-form-modal-title" class="text-2xl sm:text-3xl font-bold text-teal-700">Add New Activity</h2>
                <button id="close-activity-form-modal" class="text-stone-500 hover:text-red-600 transition-colors">
                    <span class="text-2xl font-bold">&times;</span>
                </button>
            </div>
            <form id="activity-form" class="p-4 sm:p-6 space-y-6">
                <!-- Hidden input for activity ID (for editing) -->
                <input type="hidden" id="activity-id" name="id">

                <!-- Activity Name Input -->
                <div>
                    <label for="activity-name" class="block text-stone-700 font-bold mb-2">Activity Name <span class="text-red-500">*</span></label>
                    <input type="text" id="activity-name" name="name" required class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                </div>

                <!-- Activity Type Radio Buttons -->
                <div>
                    <label class="block text-stone-700 font-bold mb-2">Activity Type <span class="text-red-500">*</span></label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="type" value="Field Game" class="form-radio text-teal-600" required>
                            <span class="ml-2 text-stone-700">Field Game</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="type" value="Team Time" class="form-radio text-teal-600">
                            <span class="ml-2 text-stone-700">Team Time</span>
                        </label>
                    </div>
                </div>

                <!-- Location Radio Buttons -->
                <div>
                    <label class="block text-stone-700 font-bold mb-2">Location <span class="text-red-500">*</span></label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="location" value="Outdoor" class="form-radio text-teal-600" required>
                            <span class="ml-2 text-stone-700">Outdoor</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="location" value="Indoor" class="form-radio text-teal-600">
                            <span class="ml-2 text-stone-700">Indoor</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="location" value="Both" class="form-radio text-teal-600">
                            <span class="ml-2 text-stone-700">Both</span>
                        </label>
                    </div>
                </div>

                <!-- Objectives Textarea -->
                <div>
                    <label for="objectives" class="block text-stone-700 font-bold mb-2">Objectives <span class="text-red-500">*</span></label>
                    <textarea id="objectives" name="objectives" rows="3" required class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Fosters individual skill development, quick thinking, coordination... (Markdown supported)"></textarea>
                </div>

                <!-- Instruction Type Selection -->
                <div>
                    <label class="block text-stone-700 font-bold mb-2">Instruction Type <span class="text-red-500">*</span></label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="instruction-type" value="general" class="form-radio text-teal-600" checked>
                            <span class="ml-2 text-stone-700">General Instructions</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="instruction-type" value="station" class="form-radio text-teal-600">
                            <span class="ml-2 text-stone-700">Station-Based Instructions</span>
                        </label>
                    </div>
                </div>

                <!-- Dynamic General Instructions Input -->
                <div id="general-instructions-section">
                    <label class="block text-stone-700 font-bold mb-2">General Instructions <span class="text-red-500">*</span></label>
                    <div id="general-instructions-container" class="space-y-3">
                        <!-- Initial instruction field, more added by JS -->
                        <div class="instruction-item flex items-center gap-2">
                            <textarea name="generalInstructions[]" rows="2" required class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., **Overall Setup:** Designate 5-7 distinct stations... (Markdown supported)"></textarea>
                            <button type="button" class="remove-instruction-btn text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                        </div>
                    </div>
                    <button type="button" id="add-general-instruction-btn" class="mt-3 bg-stone-200 text-stone-700 py-2 px-4 rounded-md hover:bg-stone-300 transition-colors">Add General Instruction Step</button>
                </div>

                <!-- Dynamic Station Instructions Input -->
                <div id="station-instructions-section" class="hidden">
                    <label class="block text-stone-700 font-bold mb-2">Station Instructions <span class="text-red-500">*</span></label>
                    <div id="station-instructions-container" class="space-y-4 border p-4 rounded-md border-stone-300">
                        <!-- Initial station field, more added by JS -->
                        <div class="station-item border-b pb-4 mb-4 last:border-b-0 last:pb-0 last:mb-0">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-stone-700">Station Details</h4>
                                <button type="button" class="remove-station-btn text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                            </div>
                            <label class="block text-stone-700 text-sm font-medium mb-1">Station Title</label>
                            <input type="text" name="stationTitles[]" required class="w-full p-2 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500 mb-2" placeholder="e.g., Station 1: Balloon Defying Gravity">
                            <label class="block text-stone-700 text-sm font-medium mb-1">Station Content</label>
                            <textarea name="stationContents[]" rows="4" required class="w-full p-2 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Setup: Clear an open space... (Markdown supported)"></textarea>
                        </div>
                    </div>
                    <button type="button" id="add-station-instruction-btn" class="mt-3 bg-stone-200 text-stone-700 py-2 px-4 rounded-md hover:bg-stone-300 transition-colors">Add Station</button>
                </div>

                <!-- Dynamic Materials Input -->
                <div>
                    <label class="block text-stone-700 font-bold mb-2">Materials Needed</label>
                    <div id="materials-container" class="space-y-3">
                        <!-- Initial material field, more added by JS -->
                        <div class="material-item flex items-center gap-2">
                            <input type="text" name="materials[]" class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Water Guns (14)">
                            <button type="button" class="remove-material-btn text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                        </div>
                    </div>
                    <button type="button" id="add-material-btn" class="mt-3 bg-stone-200 text-stone-700 py-2 px-4 rounded-md hover:bg-stone-300 transition-colors">Add Material</button>
                </div>

                <!-- Safety Notes Textarea -->
                <div>
                    <label for="safety-notes" class="block text-stone-700 font-bold mb-2">Safety Notes <span class="text-red-500">*</span></label>
                    <textarea id="safety-notes" name="safety" rows="3" required class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Ensure ample space between stations to prevent collisions... (Markdown supported)"></textarea>
                </div>

                <!-- SuperCharged Application Textarea -->
                <div>
                    <label for="supercharged-app" class="block text-stone-700 font-bold mb-2">SuperCharged Application <span class="text-red-500">*</span></label>
                    <textarea id="supercharged-app" name="supercharged" rows="3" required class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Minute to Win It games challenge us to use our unique skills... (Markdown supported)"></textarea>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end">
                    <button type="submit" id="activity-form-submit-btn" class="bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors">Add Activity</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Deleted Activities Modal (shows activities marked as deleted) -->
    <div id="deleted-activities-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto modal-content-scroll">
            <div class="sticky top-0 bg-white p-4 sm:p-6 border-b border-stone-200 flex justify-between items-center">
                <h2 class="text-2xl sm:text-3xl font-bold text-teal-700">Deleted Activities</h2>
                <button id="close-deleted-activities-modal" class="text-stone-500 hover:text-red-600 transition-colors">
                    <span class="text-2xl font-bold">&times;</span>
                </button>
            </div>
            <div id="deleted-activities-list" class="p-4 sm:p-6 space-y-4">
                <!-- Deleted activities will be listed here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (for permanent deletion) -->
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center">
            <h3 class="text-xl font-bold text-red-700 mb-4">Confirm Permanent Deletion</h3>
            <p class="text-stone-700 mb-6">Are you sure you want to permanently delete this activity? This action cannot be undone.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-permanent-delete-btn" class="bg-stone-300 text-stone-800 font-semibold py-2 px-4 rounded-lg hover:bg-stone-400 transition-colors">Cancel</button>
                <button id="confirm-permanent-delete-btn" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">Delete Permanently</button>
            </div>
        </div>
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables
        let app;
        let db;
        let auth;
        let userId; 
        let allActivities = []; // Declare allActivities once here
        let activityTypeChart; // Variable to hold the Chart.js instance
        let activityToDeleteId = null; // Stores the ID of the activity targeted for permanent deletion
        let selectedActivityForSchedule = null; // Stores the activity selected for scheduling

        // MANDATORY: Use __app_id and __firebase_config provided by the Canvas environment
        // These global variables are injected by the Canvas runtime.
        // For local development or GitHub deployment, you MUST replace the placeholder
        // firebaseConfig with your actual project's configuration from the Firebase Console.
        // Go to Project settings -> Your apps -> Firebase SDK snippet -> Config
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            // REPLACE THESE WITH YOUR ACTUAL FIREBASE PROJECT CONFIGURATION
            apiKey: "AIzaSyCNMLCw5f1ajmGLHP9gnfzojcryUIufs6E",
            authDomain: "kids-camp-guide.firebaseapp.com",
            projectId: "kids-camp-guide",
            storageBucket: "kids-camp-guide.firebasestorage.app",
            messagingSenderId: "774110400277",
            appId: "1:774110400277:web:7e3b65313073e3aacf631c",
            measurementId: "G-LL8SZ9NW8L" // Optional
        };

        /*
         * IMPORTANT: FIREBASE SECURITY RULES
         * To resolve the "Missing or insufficient permissions" error,
         * you MUST deploy the following rules to your Firebase project.
         * 1. Go to your Firebase project in the Firebase Console.
         * 2. Navigate to "Firestore Database" -> "Rules" tab.
         * 3. Replace the existing rules with the following code and click "Publish".
         *
         * rules_version = '2';
         * service cloud.firestore {
         * match /databases/{database}/documents {
         * // Allow authenticated users to read and write to public data
         * match /artifacts/{appId}/public/data/{collection=**} {
         * allow read, write: if request.auth != null;
         * }
         *
         * // Allow authenticated users to read and write to their own private data
         * match /artifacts/{appId}/users/{userId}/{collection=**} {
         * allow read, write: if request.auth != null && request.auth.uid == userId;
         * }
         *
         * // Deny all other access by default
         * match /{document=**} {
         * allow read, write: if false;
         * }
         * }
         * }
         */

        // Initial games data - these will be loaded first, then merged with user-added data from Firestore.
        // This provides a baseline set of activities even if no user data is present or Firestore fails.
        const initialGamesData = [
            {
                id: 'game1',
                name: "Minute to Win It Mayhem!",
                type: "Field Game",
                location: "Both",
                description: "A high-energy circuit of 60-second challenges. Teams rotate through various stations, accumulating points by completing diverse tasks that test skill, speed, and coordination.",
                objectives: "Fosters individual skill development, quick thinking, coordination, and team encouragement.",
                generalInstructions: [], // Empty for this game as it uses station instructions
                stationInstructions: [
                    {
                        title: "Overall Setup",
                        content: `Designate 5-7 distinct stations in your field or indoor space. Each station will host a unique Minute to Win It challenge. Ensure ample space between stations for safety and clear boundaries for each challenge area. Have a central timer (leader with a stopwatch and whistle) to signal start and stop for all stations simultaneously. Divide campers into small teams (e.g., 4-6 campers per team). Assign each team a starting station. On the first whistle, all teams begin their challenge at their assigned station. They have exactly 60 seconds to complete as much of the challenge as possible. A designated station leader will oversee each challenge, explain rules, ensure fair play, and record points. After 60 seconds, a second whistle signals the end of the round. Teams stop immediately, and station leaders tally points. Teams then quickly and safely rotate to the next designated station. This continues until all teams have visited all stations. Points are awarded per station based on the specific challenge's scoring method. Station leaders record points for their team. A central scorekeeper compiles total points at the end. The team with the highest total points wins.`
                    },
                    {
                        title: "Station 1: Balloon Defying Gravity",
                        content: `
- **Setup:** Clear an open space. Have 1-2 balloons per player ready.
- **Goal:** Keep a balloon from touching the ground for a full minute.
- **How to Play:** Each player gets a balloon. On 'Go!', players must keep their balloon in the air using any body part EXCEPT their hands (no holding!). The balloon must continually be moving.
- **Scoring:** 1 point for every 5 seconds a balloon stays airborne without hands (e.g., 12 points for a full minute). If a balloon touches the ground, that player is out for the remainder of the 60 seconds, or they can restart with a new balloon for a penalty (e.g., -5 points).
- **Challenge Up:** For more agile kids, allow only one hand, no hands at all, or add more than one balloon per player.
                        `
                    },
                    {
                        title: "Station 2: Fun Pong",
                        content: `
- **Setup:** Set up 10 plastic cups in a triangle formation at one end of a table. Fill them partially with water for stability. Mark a 'throwing line' at the opposite end of the table (approx. 5-10 feet away). Have a basket of ping pong balls ready.
- **Goal:** Get as many ping pong balls into cups as possible in one minute.
- **How to Play:** Players stand at the throwing line and try to toss ping pong balls into the cups. Players can retrieve their own balls or have a helper.
- **Scoring:** 1 point for each ball that successfully lands and stays in a cup. For an extra challenge, remove each cup a ball sinks into, making options smaller.
                        `
                    },
                    {
                        title: "Station 3: Rubber Band Shooting Gallery",
                        content: `
- **Setup:** Arrange 5-10 empty soda cans (or plastic bottles, small plastic cups) on a raised surface (e.g., a bench, small table) at varying distances. Mark a 'shooting line' 10-15 feet away. Provide a supply of rubber bands.
- **Goal:** Knock down as many cans as possible in one minute using rubber bands.
- **How to Play:** Players stand at the throwing line and fling rubber bands at the cans. They can shoot as quickly as they can reload.
- **Scoring:** 1 point for each can knocked completely off the surface. Cans are reset after each player's turn or after 60 seconds for the next team.
                        `
                    },
                    {
                        title: "Station 4: Sponge Run",
                        content: `
- **Setup:** Place a kiddie pool filled with water at one end of the designated area. Place an empty large bucket at the opposite end (approx. 20-30 feet away). Have a supply of sponges next to the kiddie pool.
- **Goal:** Transfer as much water as possible from the kiddie pool to the empty bucket using a sponge on their head, in one minute.
- **How to Play:** Players soak a sponge in the kiddie pool, place it on their head, and run across the yard to the empty bucket. They then squeeze the water from the sponge into the bucket and run back for another sponge. They cannot hold the sponge with their hands while running.
- **Scoring:** The team whose bucket has the most water (measure with a marked line or by volume) at the end of the minute wins that station's points. You can award points based on volume (e.g., 1 point per inch of water).
                        `
                    },
                    {
                        title: "Station 5: Frisbee Dunk",
                        content: `
- **Setup:** Place 3-4 kiddie pools (or large buckets/laundry baskets) at different distances from a throwing line (e.g., 10ft, 15ft, 20ft, 25ft). Assign different point values to each pool based on difficulty (e.g., closest = 5 points, furthest = 20 points). Have a supply of frisbees.
- **Goal:** Throw and 'dunk' frisbees into the pools for points in one minute.
- **How to Play:** Players stand at the throwing line and try to toss frisbees into the pools. Each player gets a set number of throws or can throw continuously for the minute.
- **Scoring:** Points are awarded based on the value of the pool the frisbee lands in. Frisbees must land completely inside the pool to count.
                        `
                    },
                    {
                        title: "Station 6: Dice Balance",
                        content: `
- **Setup:** Each player needs a popsicle stick and six dice. Have a flat, stable surface for players to stand or sit.
- **Goal:** Balance all six dice on the end of a popsicle stick held in their mouth.
- **How to Play:** On 'Go!', each player places one end of a popsicle stick in their mouth. They then attempt to stack all six dice, one by one, on the other end of the popsicle stick using only their hands. The dice must remain balanced for a count of 3 seconds.
- **Scoring:** The first player to successfully balance all six dice for 3 seconds wins that station's points. If no one balances all six, the player with the most dice balanced at the end of 60 seconds wins. You can award points based on the number of dice balanced (e.g., 1 point per die).
                        `
                    }
                ],
                materials: ["Balloons (3 bags)", "Plastic Cups (100)", "Rubber Bands (1 large ziploc)", "Ping Pong Balls (suggested purchase - approx. 50)", "Old Soda Can (collect prior to camp)", "Kiddie Pools (4)", "Large Buckets (4)", "Sponges (21½ bags)", "Frisbees (26)", "Popsicle Sticks (various)", "Dice (approx. 30, for Dice Balance)", "Stopwatch (1)", "Whistle (2)", "Scoreboard (1)", "Pencils", "Cardstock Paper"],
                safety: "Ensure ample space between stations to prevent collisions. Supervise any water-related challenges closely to prevent slipping. Remind children to handle materials gently and avoid throwing items at others. Clear instructions on safe movement between stations are crucial. Emphasize no aiming rubber bands or frisbees at people. Ensure dice are clean for mouth contact.",
                supercharged: "Minute to Win It games challenge us to use our unique skills and talents quickly and effectively. Just like God has given each of us different gifts and abilities, these games show us how we can use those gifts – whether it's speed, precision, or balance – to do our best. It also reminds us to encourage our teammates, cheering them on even when things get tough, just as we should encourage one another in our faith journey. Every moment counts, both in the game and in how we live for God.",
                deleted: false // New field for soft delete
            },
            {
                id: 'game2',
                name: "The Ultimate Obstacle Relay",
                type: "Field Game",
                location: "Both",
                description: "Teams navigate a custom-built obstacle course combining various physical challenges in a relay format, emphasizing speed, agility, and teamwork.",
                objectives: "Enhances speed, coordination, collaborative problem-solving, and teamwork.",
                generalInstructions: [
                    "**Overall Setup:** Design and construct an obstacle course using available equipment. Aim for 3-5 distinct segments that require different movements (e.g., crawling under pool noodles, weaving through cones, jumping over hula hoops, balancing on a line, throwing a bean bag into a bucket). Ensure the course is clearly marked and safe. Example segments:",
                    "- **Crawl Tunnel:** Drape a tarp over two chairs or low obstacles to create a tunnel to crawl through.",
                    "- **Cone Weave:** Place 5-7 cones in a zig-zag pattern for players to weave around.",
                    "- **Hula Hoop Hop:** Lay 5-7 hula hoops on the ground in a line or zig-zag for players to hop into each one.",
                    "- **Balance Beam:** Lay a long rope or masking tape line on the ground for players to walk across without stepping off.",
                    "- **Target Toss:** Place a bucket or laundry basket a short distance away for players to throw a bean bag into.",
                    "**Team Formation:** Divide campers into equal teams. Have each team line up single-file behind a designated starting line.",
                    "**Relay Start:** On the 'Go!' signal, the first team member from each team begins navigating the first segment of the obstacle course.",
                    "**Segment Completion & Tag:** Once a player completes a segment, they must perform a designated 'tag' (e.g., high-five, tap on the shoulder) to the next teammate in line. The next teammate then proceeds through their assigned segment. For longer courses, you may have players complete the entire course before tagging the next teammate.",
                    "**Course Progression:** The relay continues with teammates completing segments in sequence. If a player fails a segment (e.g., steps off the balance beam, misses the target toss), they must restart that segment until successful.",
                    "**Winning:** The first team to have all its members successfully complete the entire obstacle course wins. Emphasize teamwork and encouragement throughout."
                ],
                stationInstructions: [], // Empty for this game as it uses general instructions
                materials: ["Pool Noodles (36)", "Inflatable Balls (3)", "Cones (various)", "Hula Hoops (25)", "Bean Bags (10)", "Wooden Blocks (32)", "Buckets (various)", "Tennis Balls (50+)", "Frisbees (26)", "Masking Tape or Rope", "White Tarp (1)"],
                safety: "Clear the play area of any tripping hazards. Emphasize safe running, crawling, and proper equipment handling. Close supervision is essential, especially during balance tasks or segments that involve climbing/crawling. Ensure obstacles are stable and won't tip over.",
                supercharged: "Just like navigating an obstacle course requires teamwork and perseverance, our faith journey often presents challenges that we can overcome with God's help and the support of our community. Each obstacle represents a hurdle, and with every step, we learn to trust God more and rely on each other. What 'obstacles' in your life can you ask God and your friends to help you navigate?",
                deleted: false
            },
            {
                id: 'game3',
                name: "Water Gun Capture the Flag",
                type: "Field Game",
                location: "Outdoor",
                description: "A refreshing twist on the classic game. Teams use water guns and sponges to tag opponents while trying to capture the other team's 'flag'—a bucket of water.",
                objectives: "Enhances strategic thinking, teamwork, agility, and communication.",
                generalInstructions: [
                    "**Setup:** Divide a large outdoor field into two distinct halves using cones or natural boundaries. Place a large, clearly visible bucket of water (the 'flag') deep within each team's territory. Set up a 'jail' area for each team, clearly marked (e.g., a small square of cones). Ensure there are water refill stations for water guns near the boundaries.",
                    "**Team Formation:** Divide campers into two equal teams. Provide each player with a water gun and/or a small sponge.",
                    "**Tagging Rules:** Players are 'tagged' if they are hit by water from an opponent's water gun or touched by a soaked sponge thrown by an opponent. Once tagged, a player must immediately go to the opposing team's designated 'jail' area. Players cannot be tagged while in their own 'jail' or while returning from 'jail' to their own territory after being freed.",
                    "**Jail Break:** A player in 'jail' can be freed if a teammate tags them without being tagged themselves. Once freed, they can re-enter the game. Only one player can be freed at a time by a single rescuer.",
                    "**Capturing the Flag:** To win, a player must sneak into the opponent's territory, reach their 'flag' (bucket of water), soak a sponge in it, and then carry that soaked sponge back to their own territory without being tagged. If they are tagged while carrying the soaked sponge, they go to jail, and the sponge is returned to the opponent's flag bucket. The sponge must be carried, not thrown, once soaked.",
                    "**Winning:** The first team to successfully capture the opponent's 'flag' (soaked sponge) and bring it back to their own side wins the round. Play multiple rounds for best of three or five."
                ],
                stationInstructions: [],
                materials: ["Water Guns (14)", "Sponges (21½ bags)", "Large Buckets (various)", "Cones", "Kiddie Pools (for water refills)", "Whistles (2)"],
                safety: "**Strict rule:** Aim water only at the body, never at faces or heads. Emphasize no running with water guns pointed at others. Supervise water refills to prevent slipping hazards. Ensure the playing field is free of obstacles that could cause trips. Remind players to be aware of their surroundings and not to run into others.",
                supercharged: "In Capture the Flag, we work together to achieve a common goal, just like in our faith, we are part of God's team, working to spread His love and truth. Sometimes we need to be strategic, sometimes we need to rescue others, and sometimes we need to protect what's important. How can we be good teammates for God's kingdom?",
                deleted: false
            },
            {
                id: 'game4',
                name: "Human Foosball Frenzy",
                type: "Field Game",
                location: "Both",
                description: "Players link arms or hold onto pool noodles in rows, restricted to side-to-side movement like a foosball table. They must work together to kick a large ball into the opponent's goal.",
                objectives: "Emphasizes coordination, teamwork, spatial awareness, and constant communication.",
                generalInstructions: [
                    "**Setup:** Create a large rectangular playing area (e.g., 30ft x 15ft) using cones or boundary markers. Inside this area, use ropes or pool noodles to create 3-4 parallel 'lanes' across the width of the field. Players will stand in these lanes, holding onto the rope/noodle. Place a goal (e.g., two cones spaced apart) at each end of the rectangle. The ball should be an inflatable beach ball or similar large, lightweight ball.",
                    "**Team Formation:** Divide campers into equal teams. Assign each player to a specific lane. Players in the same lane on opposing teams will face each other. Players must hold onto a rope or pool noodle, restricting them to only move horizontally within their lane. They cannot move forward or backward out of their designated lane. Ensure an equal number of players per lane, or adjust lane sizes accordingly.",
                    "**Game Start:** Place the large inflatable ball in the center of the playing area. On the whistle, the game begins.",
                    "**Game Play:** Players must work together within their restricted horizontal movement to pass the ball to teammates in other lanes and eventually shoot it into the opponent's goal. Players can only use their feet to kick the ball. If the ball goes out of bounds, it is returned to the nearest boundary line and put back into play by the team that did not cause it to go out (e.g., a simple kick-in from the sideline).",
                    "**Scoring:** A point is scored when the ball successfully enters the opponent's goal. After a goal, the ball is returned to the center for a restart.",
                    "**Winning:** Play for a set time (e.g., 15-20 minutes) or until one team reaches a target score (e.g., 5-7 goals). The team with the most points at the end wins."
                ],
                stationInstructions: [],
                materials: ["Pool Noodles (36)", "Inflatable Ball", "Cones (for goals and boundaries)", "Whistles (2)"],
                safety: "Emphasize no excessive pulling or pushing on the ropes/noodles to prevent injury. Ensure the playing surface is even and free of obstacles. Supervise closely to prevent collisions, especially when players are moving quickly sideways. Remind players to be mindful of their teammates' positions and to avoid kicking too hard or at other players.",
                supercharged: "In Human Foosball, we're all connected and have to move together to achieve our goal. This reminds us that in God's family, we are all connected, and we need to work together, communicate, and support each other to reach our spiritual goals. How can we better connect and communicate with others in our faith community?",
                deleted: false
            },
            {
                id: 'game5',
                name: "Human Tic-Tac-Toe Relay",
                type: "Field Game",
                location: "Both",
                description: "Transforms tic-tac-toe into a dynamic team relay. Teams race to place markers on a giant grid, aiming for three in a row.",
                objectives: "Enhances speed, strategic thinking, teamwork, and coordination.",
                generalInstructions: [
                    "**Setup:** Use masking tape, rope, or cones to create a large 3x3 tic-tac-toe grid on the floor or ground (e.g., each square 3ft x 3ft). Designate a clear start line about 15-20 feet away from the grid. Ensure enough space around the grid for players to run.",
                    "**Team Formation:** Divide campers into two equal teams (Team X and Team O). Provide each team with a distinct set of 5-6 markers (e.g., Team X uses frisbees, Team O uses bean bags). Each team lines up single-file behind their respective start line.",
                    "**Relay Start:** On 'Go!', the first player from Team X runs from their start line to the tic-tac-toe grid. They place one of their team's markers into any empty square on the grid. After placing the marker, they run back and 'tag' (e.g., high-five) to the next teammate in line.",
                    "**Alternating Turns:** Immediately after Team X's player tags their teammate, the first player from Team O runs to the grid, places their marker in an empty square, and runs back to tag their next teammate. Teams alternate turns in this relay fashion.",
                    "**Moving Markers (if grid is full):** If the grid becomes full (all 9 squares have markers) and no one has three in a row, players can then choose to move one of their *existing* markers from one square to another *empty* square to try and get three in a row. They still must run to the grid, move the marker, and run back to tag. They cannot move an opponent's marker.",
                    "**Winning:** The game continues until one team successfully gets three of their markers in a row (horizontally, vertically, or diagonally). The first team to achieve this wins the round. Play multiple rounds for best of three or five."
                ],
                stationInstructions: [],
                materials: ["Masking Tape or Rope", "Frisbees (26)", "Bean Bags (10)", "Plastic Balls (2 bags)", "Cones (various)", "Whistles (2)", "Stopwatch (1)"],
                safety: "Ensure the play area is clear of tripping hazards. Emphasize safe running and avoiding collisions, especially when multiple players are moving near the grid. Remind children to place markers gently and not to throw them at others. Ensure players do not interfere with opponents' turns.",
                supercharged: "In Human Tic-Tac-Toe, we need to think ahead and work together to achieve our goal. This is like our spiritual walk, where we need to be strategic in how we live our lives for God, making wise choices and working with others in the Body of Christ to advance His kingdom. How can we be more intentional in our daily choices to honor God?",
                deleted: false
            },
            {
                id: 'game6',
                name: "Indoor Bowling Bonanza",
                type: "Field Game",
                location: "Indoor",
                description: "Classic bowling game indoors. Teams roll a bowling ball or inflatable ball to knock down pins or stacked plastic cups.",
                objectives: "Enhances aim, strategy, and teamwork.",
                generalInstructions: [
                    "**Setup:** Choose a long, clear indoor space (e.g., gym, large hall). At one end, set up 10 bowling pins in a standard triangle formation (1-2-3-4 formation), or stack 10 plastic cups in a pyramid (4-3-2-1 formation). Mark a clear 'rolling line' about 15-20 feet away from the pins using masking tape. Ensure there is enough space for the ball to roll and for players to stand safely.",
                    "**Team Formation:** Divide campers into small teams (e.g., 3-5 players per team). Each team will take turns bowling.",
                    "**Game Play:** A player from the first team stands behind the rolling line and rolls the bowling ball (or inflatable ball) towards the pins/cups. They get two rolls per turn, just like in traditional bowling, to knock down as many as possible. Players must remain behind the rolling line until the ball has stopped.",
                    "**Scoring:** Points are awarded for each pin/cup knocked down (e.g., 1 point per pin). A perfect strike (all 10 pins on the first roll) can earn bonus points (e.g., 15 points). A spare (all 10 pins on two rolls) can earn a slightly smaller bonus (e.g., 12 points). Keep score on a whiteboard or large paper. After a player's turn, the pins are reset.",
                    "**Winning:** Play for a set number of rounds (e.g., 5-10 rounds per team) or until a target score is reached. The team with the most points at the end wins."
                ],
                stationInstructions: [],
                materials: ["Bowling Ball (1)", "Bowling Pins (10)", "Plastic Cups (100)", "Inflatable Balls (3)", "Masking Tape", "Cones", "Scoreboard (1)", "Pencils", "Cardstock Paper", "Whistles (2)", "Stopwatch (1)"],
                safety: "Ensure the rolling area is clear and dry to prevent slipping. Remind children to roll, not throw, the ball, and to keep it low to the ground. Supervise closely to ensure children are not in the ball's path, especially when pins are being reset. Designate clear 'return' paths for the ball and ensure players wait until the ball is stationary before approaching the pins.",
                supercharged: "Bowling requires focus and aiming for a target. In our spiritual lives, we are called to 'aim' for God's purposes, staying focused on Him and His will. Even if we miss sometimes, we get another chance, just like in bowling. What are some spiritual targets you can aim for this week?",
                deleted: false
            },
            {
                id: 'game7',
                name: "Giant Slingshot Target Challenge",
                type: "Field Game",
                location: "Both",
                description: "Teams test aim and precision using slingshots to launch projectiles at targets for points.",
                objectives: "Enhances aim, precision, teamwork, and coordination.",
                generalInstructions: [
                    "**Setup:** Designate a clear 'shooting line' using tape or cones. Set up various targets at different distances from the shooting line, assigning different point values to each target (e.g., closer targets = 5 points, medium = 10 points, furthest/smallest = 20 points). Targets can include buckets, laundry baskets, hula hoops laid flat, or stacked plastic cups. Ensure a clear and safe backstop behind the targets to contain projectiles. Provide each team with a slingshot and a supply of soft, safe projectiles (e.g., tennis balls, plastic balls, crumpled paper, small clay balls).",
                    "**Team Formation:** Divide campers into small teams (e.g., 3-5 players per team). Each team will take turns shooting.",
                    "**Game Play:** Teams send one player at a time to the shooting line. The player uses the slingshot to launch a projectile at the targets. They get a set number of shots per turn (e.g., 3-5 shots). After shooting, the player retrieves their projectiles (if safe to do so and not interfering with other players) and returns to tag the next player in line. Only one player should be at the shooting line at a time.",
                    "**Scoring:** Points are tallied for successful hits on targets. Projectiles must hit or land inside the target to count. A designated scorekeeper records points for each team.",
                    "**Winning:** The game continues for a set time (e.g., 20-30 minutes) or until all players have had a predetermined number of turns. The team with the highest total score at the end wins."
                ],
                stationInstructions: [],
                materials: ["Sling Shots (4)", "Tennis Balls (50+)", "Plastic Balls (2 bags)", "Bean Bags (10)", "Cotton Balls (suggested purchase)", "Large Buckets (various)", "Laundry Baskets (11)", "Tiny Garbage Cans (9)", "Cones", "Hula Hoops (25)", "Scoreboard (1)", "Pencils", "Cardstock Paper", "Whistles (2)", "Stopwatch (1)"],
                safety: "**Strict Rules:** Emphasize aiming ONLY at designated targets, NEVER at people or animals. Ensure a clear safety zone around targets and behind the shooter where no one should stand. Projectiles MUST be soft and harmless. Supervise closely to ensure proper and safe use of slingshots and projectiles. Collect projectiles promptly to prevent tripping hazards. Ensure no one walks in front of the shooter.",
                supercharged: "Just like we aim for targets with the slingshot, in our faith, we aim to live lives that honor God and hit the mark of His calling. Sometimes it takes practice and patience. What are some ways we can practice aiming for God's will in our daily lives?",
                deleted: false
            },
            {
                id: 'game8',
                name: "Sponge Ball Toss",
                type: "Field Game",
                location: "Both",
                description: "Teams throw sponges or bean bags at various targets for points, testing their aim and precision.",
                objectives: "Enhances aim, precision, and teamwork.",
                generalInstructions: [
                    "**Setup:** Designate a 'throwing line' using tape or cones. Set up various targets at different distances and heights, assigning different point values (e.g., closer targets = 5 points, higher/further = 10 points). Targets can include large buckets, laundry baskets, hula hoops, or even leaders holding targets. Ensure a clear area for throws and where projectiles will land. Provide each team with a supply of sponges or bean bags.",
                    "**Team Formation:** Divide campers into small teams (e.g., 3-5 players per team). Each team will take turns throwing.",
                    "**Game Play:** Teams send one player at a time to the throwing line. The player throws a set number of sponges/bean bags (e.g., 3-5 throws) at the targets. After their throws, the player retrieves their projectiles (if safe to do so and not interfering with others) and returns to tag the next player in line. Only one player should be at the throwing line at a time.",
                    "**Scoring:** Points are tallied for successful hits on targets. Projectiles must hit or land inside the target to count. A designated scorekeeper records points for each team.",
                    "**Optional: Deflectors:** For an added challenge, leaders can hold pool noodles to act as deflectors, making it harder to hit targets. Ensure deflectors are held safely and do not interfere with the throwing motion.",
                    "**Winning:** The game continues for a set time (e.g., 20-30 minutes) or until all players have had a predetermined number of turns. The team with the most points at the end wins."
                ],
                stationInstructions: [],
                materials: ["Sponges (21½ bags)", "Bean Bags (10)", "Large Buckets (various)", "Laundry Baskets (11)", "Tiny Garbage Cans (9)", "Cones", "Hula Hoops (25)", "Scoreboard (1)", "Pencils", "Cardstock Paper", "Whistles (2)", "Stopwatch (1)", "Pool Noodles (36)"],
                safety: "Ensure the throwing area is clear of obstacles. Remind children to throw gently, only at designated targets, and never at people. Supervise closely to ensure safe throwing and retrieval of projectiles. Ensure no one walks in front of the thrower.",
                supercharged: "Tossing a sponge at a target requires focus and a steady hand. In life, we are called to be 'on target' with God's will, using our gifts to serve others with precision and care. When we aim to serve God, we can make a big impact. What are some ways you can 'hit the target' by serving others this week?",
                deleted: false
            },
            {
                id: 'game9',
                name: "Bed Sheet Volleyball/Ping Pong",
                type: "Field Game",
                location: "Both",
                description: "Teams use a large bed sheet held taut to volley an inflatable ball over a net or designated line, mimicking volleyball or ping pong.",
                objectives: "Enhances coordination, teamwork, communication, and hand-eye coordination.",
                generalInstructions: [
                    "**Setup:** Divide the playing area (field or gym) into two halves. Set up a 'net' in the middle: if outdoors, string a rope between two poles or trees at a height appropriate for the campers; if indoors, use a line of cones or masking tape on the floor. Provide each team with a large bed sheet (at least twin size, larger is better for more players) and an inflatable ball (e.g., beach ball).",
                    "**Team Formation:** Divide campers into two equal teams. Each team will gather around their bed sheet, holding the edges of the sheet taut with both hands. The number of players per sheet depends on the sheet size (e.g., 4-8 players per sheet). All players must hold onto the sheet at all times during play.",
                    "**Game Play:** To start, one team places the inflatable ball on their taut bed sheet. Working together, they must use the sheet to launch the ball over the 'net' to the opposing team's side. The opposing team must then try to 'catch' the ball on their sheet without letting it touch the ground. Once caught, they must volley it back over the net. The ball must go over the net and land within the opposing team's boundaries.",
                    "**Scoring:** A point is scored when: \n- The ball hits the ground on the opponent's side of the net (within bounds). \n- The ball goes out of bounds. \n- A team drops the ball (fails to catch it on their sheet). \n- The ball hits the net and doesn't go over. \nThe team that scores the point gets to serve the ball for the next round.",
                    "**Winning:** Play to a predetermined score (e.g., first to 15 points, winning by 2) or for a set time limit (e.g., 15-20 minutes). The team with the most points at the end wins."
                ],
                stationInstructions: [],
                materials: ["Bed sheets (2 large - suggested camp supply)", "Inflatable Balls (3)", "Rope (7 available)", "Masking Tape (3 rolls)", "Cones (various)", "Whistles (2)"],
                safety: "Ensure players are spaced out around the sheet to avoid collisions and accidental hitting. Remind children to hold the sheet firmly and not to let go suddenly. Ensure the playing area is clear of obstacles. Supervise closely to prevent excessive pulling or tugging on the sheet that could cause falls. Emphasize that players should not swing the sheet at other players.",
                supercharged: "Bed Sheet Volleyball shows us how important it is to work together, communicate, and support each other. Just like everyone holding the sheet has a role, every person in God's family has a unique role to play, and we need each other to succeed. How can you better support your friends and family in their faith journeys?",
                deleted: false
            },
            {
                id: 'game10',
                name: "Kiddie Pool Treasure Hunt",
                type: "Field Game",
                location: "Outdoor",
                description: "Campers search for hidden 'treasures' submerged in kiddie pools, often blindfolded or using only their feet, relying on touch and teamwork.",
                objectives: "Enhances tactile exploration, problem-solving, and communication (if guided).",
                generalInstructions: [
                    "**Setup:** Place several small kiddie pools in a designated outdoor area. Fill each pool with water to a depth that allows treasures to be submerged but is safe for children. Submerge various 'treasures' at the bottom of the pools (e.g., fake gold coins, plastic critters, diving octopi, weighted plastic balls). Ensure the treasures are safe to handle, clean, and easily distinguishable by touch. Have blindfolds or bandanas ready.",
                    "**Team Formation:** Divide campers into teams. Each team will take turns sending one or two players to search the pools.",
                    "**Game Play (Option 1 - Blindfolded):** One player from a team is blindfolded. They approach a pool and, guided verbally by their non-blindfolded teammates, attempt to find and retrieve as many treasures as possible within a set time limit (e.g., 60-90 seconds). The blindfolded player cannot see, relying entirely on their teammates' instructions. Teammates must stay outside the pool and can only use verbal commands (e.g., 'left a little', 'straight ahead', 'mine on your right', 'mine on your right').",
                    "**Game Play (Option 2 - Feet Only):** Players are not blindfolded but must use only their feet/toes to search for and retrieve treasures from the bottom of the pool. No hands allowed. This can be done individually or as a relay.",
                    "**Scoring:** After the time limit, count the treasures collected by the player. The treasures are then returned to the pool for the next team. The team with the most treasures collected at the end wins. You can assign different point values to different types of treasures if desired.",
                    "**Rotation:** Teams rotate through the pools until all players have had a turn, or for a set number of rounds."
                ],
                stationInstructions: [],
                materials: ["Small Kiddie Pools (4)", "Fake Gold Coins (approx 130)", "Plastic Critters (2 large ziplocks)", "Small Plastic Dinosaurs (30)", "Diving Octopi (1 set of 6)", "Blindfolds (or Bandanas - approx. 70)", "Whistles (2)", "Stopwatch (1)"],
                safety: "Ensure pools are on a flat, stable surface to prevent tipping. Supervise children closely around water to prevent splashing into eyes or accidental falls. Remind children not to push or splash excessively. Ensure all submerged 'treasures' are clean, smooth, and safe to handle. Emphasize calm and clear communication for blindfolded players to avoid disorientation.",
                supercharged: "Searching for treasure reminds us of seeking God's truth and wisdom. Sometimes it feels like we're blindfolded, but God provides guides (like the Holy Spirit and wise mentors) to help us find the precious truths hidden in His Word. What 'treasures' (truths) have you found in the Bible lately?",
                deleted: false
            },
            {
                id: 'game11',
                name: "The Great Camp Invention Challenge",
                type: "Team Time",
                location: "Indoor",
                description: "Teams receive a mystery box of random items and a camp-related problem. They must invent a solution, build a prototype, and present it with a jingle.",
                objectives: "Fosters creativity, collaborative problem-solving, communication, and presentation skills.",
                generalInstructions: [
                    "**Setup:** Prepare 'mystery boxes' for each team. Each box should contain a variety of random, safe, and diverse items (e.g., cardboard, popsicle sticks, rubber bands, plastic spoons, plastic cups, yarn, CDs, pipe cleaners, small plastic toys, empty paper towel rolls, fabric scraps, string, paper clips, aluminum foil). Also, prepare a 'problem prompt' for each team written on a card (e.g., 'Invent a device to help campers make new friends', 'Create a system to keep tents tidy', 'Design a way to make Bible study more fun', 'Build a tool to help carry supplies'). Provide basic tools like glue sticks, white glue, tape, and scissors.",
                    "**Team Formation:** Divide campers into small teams (e.g., 4-6 campers per team). Give each team a mystery box and a problem prompt. Designate a workspace for each team.",
                    "**Brainstorm & Build (30-40 minutes):** Teams have this time to brainstorm ideas, design their invention, and build a prototype using *only* the materials in their mystery box. Encourage them to think creatively and collaboratively. Remind them that the prototype doesn't have to be perfect, but it should clearly demonstrate their idea.",
                    "**Jingle Creation (during building time):** During the building time, teams must also create a short, catchy jingle or slogan for their invention. The jingle should explain its purpose and benefits in a fun, memorable way (e.g., a short song, a rhyme, a cheer).",
                    "**Presentation (5-7 minutes per team):** After the building time, each team presents their invention to the larger group. They should explain: \n1. The problem they addressed. \n2. How their invention works and what it does. \n3. What materials they used and why. \n4. Perform their jingle/slogan. \nEncourage questions from other teams after each presentation.",
                    "**Judging/Awards:** Leaders can award points or fun prizes for categories such as: Most Creative Invention, Best Teamwork, Funniest Jingle, Most Practical Solution, Best Presentation, etc."
                ],
                stationInstructions: [],
                materials: ["Cardboard Boxes (2)", "Popsicle Sticks (various)", "Rubber Bands (various)", "Plastic Critters (2 large ziplocks)", "Foam Beads (1 bag ziplocks)", "Yarn (various)", "CDs (17)", "Skewers (various)", "Toothpicks (500)", "Plastic Cups (100)", "Wooden Blocks (32)", "Construction Paper (various)", "Washable Markers (various)", "Glue Sticks (various)", "White Glue Bottles (11)", "Scissors (various)", "Stopwatch (1)", "Masking Tape", "Scotch Tape", "Aluminum Foil (suggested purchase)"],
                safety: "Ensure all mystery box items are safe for children to handle. Supervise the use of scissors and glue carefully. Remind children not to put small items in their mouths. Ensure the building area is tidy to prevent tripping hazards. Emphasize that inventions should be demonstrated safely and not used to hit or harm others.",
                supercharged: "This challenge reminds us that God has given us creativity and problem-solving skills. He wants us to use our minds and talents to find solutions, just like we invented things today. How can you use your creativity to solve problems or bless others in your life?",
                deleted: false
            },
            {
                id: 'game12',
                name: "Minefield & Power-Up Scavenger Hunt",
                type: "Team Time",
                location: "Both",
                description: "Blindfolded players navigate a 'minefield' of soft obstacles, guided verbally by teammates to collect 'power-ups' representing Foursquare values.",
                objectives: "Enhances trust, communication, active listening, teamwork, and reinforces camp values.",
                generalInstructions: [
                    "**Setup:** In an open indoor or outdoor area, scatter 'mines' (e.g., cones, bean bags, soft objects like small balls or crumpled paper) randomly across the space. These are obstacles to be avoided. Then, strategically place 'power-up' items (e.g., laminated Bible verses, rubber ducks, fake gold coins, plastic critters, wooden blocks, small laminated pictures representing Foursquare values) throughout the minefield. Ensure power-ups are distinct from mines and easily identifiable by touch or by a quick verbal description from guides. Have blindfolds or bandanas ready.",
                    "**Team Formation:** Divide campers into small teams (e.g., 4-6 campers per team). Each team will designate one player to be the 'navigator' (blindfolded) and the rest to be the 'guides'. Teams should have a designated 'collection zone' for their power-ups.",
                    "**Game Play:** The navigator is blindfolded and stands at the edge of the minefield. On 'Go!', the guides must use only verbal instructions (no touching, pointing, or physical contact!) to direct their blindfolded navigator through the minefield. The goal is to collect as many 'power-ups' as possible while avoiding touching any 'mines'. Once a power-up is found, the navigator must bring it back to their team's collection zone before seeking another.",
                    "**Mine Penalty:** If the navigator touches a 'mine', they must immediately stop. The guides must then verbally direct them back to the starting point of that specific segment of the minefield (or the beginning of the entire minefield, depending on desired difficulty) before they can continue their search.",
                    "**Scoring:** Teams earn points for each 'power-up' successfully collected and brought back to their collection zone. The game can be timed (e.g., 10-15 minutes), with the team collecting the most power-ups in that set time winning, or the first team to collect all designated power-ups winning. Rotate navigators within each team so everyone gets a chance to experience both roles.",
                    "**Guide Communication:** Emphasize clear, concise, and calm verbal guidance. Guides should use directional words (e.g., 'take two steps forward', 'turn slightly left', 'mine on your right', 'mine on your right').'"
                ],
                stationInstructions: [],
                materials: ["Cones (various)", "Bean Bags (10)", "Whistles (2)", "Blindfolds (or Bandanas - approx. 70)", "Laminated Bible Chapter Names (2 sets)", "Rubber Duckies (44)", "Fake Gold Coins (approx 130)", "Plastic Critters (2 large ziplocks)", "Wooden Blocks (32)", "Plastic Balls (2 bags)", "Laminated Foursquare Symbols/Values (suggested purchase)"],
                safety: "Ensure the play area is completely clear of actual hazards (e.g., sharp objects, uneven ground). Use only soft 'mines' that won't cause injury if stepped on. Supervise closely to prevent collisions between blindfolded players or with static objects. Emphasize gentle, clear, and calm verbal guidance from the guides. No running for blindfolded players. Guides must ensure the path is clear before giving 'go ahead' commands.",
                supercharged: "Navigating the minefield blindfolded teaches us to trust and listen to our guides. In life, God is our ultimate guide, and we can trust His Word and the wisdom of those He places in our lives. The 'power-ups' represent the spiritual blessings and truths we find when we follow His guidance. What 'treasures' (truths) have you found in the Bible lately?",
                deleted: false
            },
            {
                id: 'game13',
                name: "Camp Code Breakers",
                type: "Team Time",
                location: "Indoor",
                description: "Campers use logic and communication to decode secret messages (substitution ciphers, bead sequences). Decoded messages reveal Foursquare values, Bible verses, or clues.",
                objectives: "Enhances problem-solving, logical thinking, communication, critical thinking, and subtly reinforces camp values.",
                generalInstructions: [
                    "**Setup:** Create 3-5 encrypted messages for each team. Ensure the messages are progressive, with one leading to the next. Examples include:\n- **Substitution Cipher:** Each letter is replaced by another (e.g., A=Z, B=Y, or a simple shift cipher like A=C, B=D). Provide a small, clear key (e.g., 'A=Z', 'B=Y') for the first message, or make it a simple pattern they can deduce.\n- **Number Code:** Each letter corresponds to a number (e.g., A=1, B=2). Provide a number-to-letter key.\n- **Bead Sequence:** A sequence of colored beads represents a word or phrase (e.g., Red-Blue-Green = 'Faith', Yellow-Yellow-Red = 'Love'). Provide a clear legend for the bead code.\nThe decoded messages should reveal Foursquare values, short Bible verses, or clues leading to the next message. Place the first message and any necessary decoding tools (pencils, paper, bead legend, cipher key) in a sealed envelope labeled for each team.",
                    "**Team Formation:** Divide campers into small teams (e.g., 3-5 campers per team). Give each team their first encrypted message envelope and a clipboard/writing surface.",
                    "**Game Play:** Teams collaboratively work to decode their message. They must use the provided key or their own logic to figure out the code. Encourage discussion and collaboration within the team. Once a message is decoded, they show it to a leader to verify. If correct, the leader provides the next encrypted message or clue. If incorrect, the leader can give a small hint (e.g., 'check your second word') and send them back to try again.",
                    "**Winning:** The game continues until all messages are decoded, leading to a final message (e.g., 'You have unlocked the secret of teamwork!') or a small 'treasure' (e.g., a bag of fake gold coins, a small treat). The first team to successfully decode all messages wins."
                ],
                stationInstructions: [],
                materials: ["ABC Beads (3 sets)", "Colored Beads (3 sets)", "Pencils (various)", "Pens (3)", "Cardstock Paper (50)", "Construction Paper (various)", "Washable Markers (various)", "Sticky Notes (various)", "Laminated Bible Chapter Names (2 sets)", "Small Metal Cups (6)", "Plastic Critters (2 large ziplocks)", "Clipboards (4)", "Stopwatch (1)", "Envelopes"],
                safety: "Ensure all materials are safe for children to handle. Keep the area organized to prevent clutter. Remind children not to put small items in their mouths. Emphasize fair play and not peeking at other teams' solutions.",
                supercharged: "Decoding messages requires careful thought and teamwork, just like understanding God's Word requires us to study and seek His truth together. The 'secrets' we uncover in the Bible reveal more about God's plan and love for us. What 'messages' is God speaking to you through His Word right now?",
                deleted: false
            },
            {
                id: 'game14',
                name: "The Great Camp Contraption Challenge",
                type: "Team Time",
                location: "Indoor",
                description: "Teams design and build a Rube Goldberg-esque contraption using camp supplies to achieve a simple task (e.g., move an object, pop a balloon).",
                objectives: "Fosters engineering design, creative problem-solving, collaborative planning, and understanding of cause-and-effect.",
                generalInstructions: [
                    "**Setup:** Designate a building area for each team (e.g., a section of a table or floor, or a designated corner). Provide each team with a diverse assortment of safe, random camp materials (e.g., cardboard, popsicle sticks, rubber bands, plastic spoons, plastic cups, string, small plastic balls, CDs, tape, glue, empty bottles/cans, paper towel rolls, marbles, dominoes). Clearly state the simple task their contraption must achieve (e.g., 'move a small object from Point A to Point B', 'pop a balloon', 'ring a bell', 'turn a page', 'drop a coin into a cup'). Provide a target object for the task (e.g., a specific small ball to move, a balloon to pop).",
                    "**Team Formation:** Divide campers into small teams (e.g., 4-6 campers per team). Present the challenge: to design and build a functional catapult that can launch a projectile.",
                    "**Build Time (30-40 minutes):** Teams have this time to brainstorm, design, and construct their catapult. Encourage them to experiment with different designs and test their catapults during the building phase. Leaders should circulate to offer guidance and ensure safe construction.",
                    "**Competition Challenges:** Once the building time is up, teams will bring their catapults to a designated competition area and compete in one or more challenges: \n- **Distance Challenge:** Each team launches a projectile from a designated line, aiming for the furthest distance. Mark the landing spots and measure the distance. Each team gets 3-5 attempts. \n- **Accuracy Challenge:** Set up targets (e.g., buckets, hula hoops, marked circles on the floor) at various distances. Teams try to land projectiles inside the targets for points. Assign different point values for different targets/distances. Each team gets 3-5 attempts. \n- **Volume Challenge:** Teams try to launch as many projectiles as possible into a container within a set time (e.g., 60 seconds).",
                    "**Scoring:** Points are awarded based on performance in the chosen challenges (e.g., furthest distance in feet/meters, most accurate shots, most projectiles in the bucket). Keep a clear score for each team on a scoreboard.",
                    "**Winning:** The team with the highest total score across all challenges wins. Celebrate all efforts, regardless of score."
                ],
                stationInstructions: [],
                materials: ["Popsicle Sticks (various)", "Rubber Bands (various)", "Plastic Spoons (36)", "Plastic Cups (100)", "Small Plastic Balls (2 bags)", "Cotton Balls (suggested purchase)", "Paper Clips (suggested purchase)", "Clay (suggested purchase)", "Glue Sticks (various)", "White Glue Bottles (11)", "Scissors (various)", "Stopwatch (1)", "Measuring Tape (suggested purchase)", "Cones (for marking lines/targets)", "Buckets (various)", "Hula Hoops (25)"],
                safety: "Emphasize aiming only at designated targets, never at people. Projectiles should always be soft and harmless. Supervise the building process carefully, especially when using scissors or glue. Ensure the launching area is clear and that no one is standing in the path of projectiles. Remind children not to 'overload' or misuse the catapults in a dangerous way.",
                supercharged: "Building and launching catapults teaches us about design, precision, and cause-and-effect. In our faith, we are called to be intentional in our actions, knowing that our efforts, when guided by God, can have a far-reaching impact. What 'impact' do you want to make for God's kingdom, and what steps can you take to 'launch' into that purpose?",
                deleted: false
            },
            {
                id: 'game15',
                name: "Camp Mural Masterpiece",
                type: "Team Time",
                location: "Indoor",
                description: "Teams collaborate on a large-scale art project, creating a mural representing camp life, Foursquare values, or a chosen theme.",
                objectives: "Fosters creativity, collaborative art-making, communication, and imaginative expression.",
                generalInstructions: [
                    "**Setup:** Prepare a large surface for the mural. This could be a large white tarp laid on the floor, several large sheets of construction paper taped together on a wall or laid out, or a large roll of butcher paper. Provide a wide array of art supplies: washable markers, crayons, paints (tempera or washable acrylics), brushes, sponges, glue sticks, white glue, scissors, and various collage materials (e.g., construction paper scraps, yarn, plastic critters, laminated Bible verses for inspiration, magazine cutouts, glitter). Ensure adequate protection for the floor/tables if using paint.",
                    "**Theme & Team Formation:** Assign a clear theme for the mural (e.g., 'What Foursquare Camp Means to Me', 'Growing in Faith', 'Community in Action', 'The Fourfold Gospel'). Divide campers into teams (e.g., 4-6 campers per team). Each team can be assigned a specific section of the mural to work on, or a particular aspect of the theme to represent. Clearly mark team sections if applicable.",
                    "**Brainstorm & Create (45-60 minutes):** Teams brainstorm ideas for their section or contribution to the mural, considering how their part will connect with other teams' parts to form a cohesive whole. Campers then use the art supplies to draw, paint, and collage their section of the mural. Encourage them to be bold and expressive.",
                    "**Collaboration:** Encourage communication between teams, especially if they are working on adjacent sections, to ensure cohesion and a unified final piece. Leaders should circulate to offer guidance, support, and help with material distribution. Remind campers to share supplies and work together.",
                    "**Presentation (5-10 minutes):** Once the mural is complete (or time is up), gather the campers to view the entire masterpiece. Each team can briefly present their section, explaining what they depicted and why, and how it's connects to the overall theme. Facilitate a discussion about the entire mural and what it represents.",
                    "**Display:** Find a prominent place to display the completed mural as a reminder of their collaborative efforts and the camp's themes. Take a photo for camp memories."
                ],
                stationInstructions: [],
                materials: ["White Tarp (1)", "Construction Paper (various)", "Butcher Paper (suggested purchase)", "Washable Markers (various)", "Crayons (various)", "Sharpies (various)", "Black Paint (3 bottles)", "Pink Paint (2 bottles)", "2 Orange Paint (2 bottles)", "Blue Paint (1 bottle)", "Sponges (21½ bags)", "Glue Sticks (various)", "White Glue Bottles (11)", "Scissors (various)", "Plastic Critters (2 large ziplocks)", "Foam Beads (1 bag ziplocks)", "Yarn (various)", "CDs (17)", "Masking Tape (3 rolls)", "Laminated Bible Chapter Names (2 sets)", "Glitter (suggested purchase)", "Magazine cutouts (optional)"],
                safety: "Ensure adequate ventilation if using paints. Protect surfaces with drop cloths or newspaper. Supervise scissor and glue use carefully. Remind children not to put art supplies in their mouths. Have water and paper towels readily available for clean-up. Ensure walking paths around the mural are clear to prevent tripping over supplies.",
                supercharged: "Creating a mural together shows us how each of us is a unique part of God's beautiful masterpiece, the Church. When we combine our individual talents and efforts, we can create something much bigger and more beautiful than we could alone. How can you use your unique gifts to contribute to God's 'masterpiece'?",
                deleted: false
            },
            {
                id: 'game16',
                name: "Blindfolded Building Challenge",
                type: "Team Time",
                location: "Indoor",
                description: "Blindfolded team members build a structure (e.g., block tower, cup pattern) guided solely by verbal instructions from non-blindfolded teammates.",
                objectives: "Enhances precise communication, active listening, trust, and spatial reasoning.",
                generalInstructions: [
                    "**Setup:** Prepare a reference image or diagram of a simple structure (e.g., a specific block tower design, a pattern of stacked cups, a LEGO creation, a simple shape made of popsicle sticks). Ensure the structure is achievable with the provided materials and is not overly complex. Provide each team with an identical set of building materials (e.g., wooden blocks, plastic cups, LEGOs, popsicle sticks) and blindfolds or bandanas. Each team should have a designated building surface (e.g., a small table or clear floor space).",
                    "**Team Formation:** Divide campers into small teams (e.g., 3-5 campers per team). For each round, designate one or two team members to be the 'builders' (who will be blindfolded) and the rest to be the 'guides'. Rotate roles in subsequent rounds.",
                    "**Game Play:** The builders are blindfolded and sit at their building area with the materials within reach. The guides stand a short distance away, where they can clearly see the reference image but *cannot* touch the materials, the blindfolded builders, or the structure being built. The guides must use only verbal instructions to direct the builders to construct the replica of the reference image.",
                    "**Communication Rules:** Emphasize clear, concise, and specific instructions. Guides should describe shapes, colors, positions, and orientations precisely (e.g., 'Take the red square block', 'Place it on top of the green rectangle', 'Rotate it 90 degrees clockwise'). Builders can ask clarifying questions (e.g., 'Do you mean the long side or the short side?'), but guides cannot use gestures or touch. If the structure falls or is built incorrectly, the team must correct it or restart that section.",
                    "**Winning:** The first team to successfully build the structure exactly as shown in the reference image wins the round. You can play multiple rounds, rotating who is blindfolded and introducing new reference images for each round.",
                    "**Variations:** Increase difficulty by using more complex structures, limiting communication to only 'yes' or 'no' answers, or adding a strict time limit (e.g., 5-10 minutes per round)."
                ],
                stationInstructions: [],
                materials: ["Wooden Blocks (32)", "Plastic Cups (100)", "LEGOs (suggested purchase)", "Bandanas (approx. 70)", "Blindfolds (suggested purchase)", "Cardstock Paper (50)", "Popsicle Sticks (various)", "Stopwatch (1)", "Whistles (2)"],
                safety: "Ensure the building area is clear and safe to prevent tripping or bumping into objects. Remind children to be gentle with the materials and each other. Supervise closely to ensure blindfolded players are safe and not frustrated. Provide clear boundaries for the guides to prevent them from interfering physically. All building materials must be safe and non-toxic.",
                supercharged: "This challenge teaches us about the importance of clear communication and trust. Just as the blindfolded builder trusts their teammates, we can trust God's guidance for our lives, even when we can't see the path ahead. And like the guides, we are called to communicate God's truth clearly to others. How can you practice trusting God more and communicating His truth to those around you?",
                deleted: false
            },
            {
                id: 'game17',
                name: "Camp Storytelling Charades",
                type: "Team Time",
                location: "Indoor",
                description: "Teams act out camp-related or Foursquare-themed prompts (e.g., 'roasting marshmallows,' 'praying together'), fostering creative expression and non-verbal communication.",
                objectives: "Encourages creative expression, non-verbal communication, and quick thinking.",
                generalInstructions: [
                    "**Setup:** Prepare numerous slips of paper, each with a prompt written on it. Prompts should be camp-related activities (e.g., 'roasting marshmallows', 'swimming in the lake', 'singing campfire songs', 'packing a suitcase', 'going on a hike', 'telling ghost stories'), Foursquare values (e.g., 'praying together', 'healing the sick', 'sharing the Gospel', 'GIVING GENEROUSLY', 'reading the Bible'), or simple Bible concepts/stories (e.g., 'Noah's Ark', 'David and Goliath', 'Jesus walking on water'). Fold the slips and place them in a bucket or container. Designate a clear acting area for each team, visible to their teammates.",
                    "**Team Formation:** Divide campers into small teams (e.g., 4-6 players per team). Each team will take turns acting.",
                    "**Game Play:** The first player from Team A runs to the bucket, picks one slip of paper (no 'fishing' for easy ones!), and returns to their team. Standing in the designated acting area, the player acts out the prompt for their teammates. They cannot speak, make sounds, or mouth words – only gestures, facial expressions, and body language are allowed. Set a time limit for guessing (e.g., 60 seconds per prompt).",
                    "**Guessing & Scoring:** Teammates yell out their guesses. The moment the correct prompt is guessed, the team earns a point. If the team guesses correctly within the time limit, the actor then goes to the end of their team's line, and the next player in line for that team can immediately run to the bucket to get the next prompt. If they don't guess within the time limit, no points are awarded for that prompt, and the turn passes to the next team.",
                    "**Alternating Turns:** Teams alternate turns.",
                    "**Winning:** The game continues for a set time (e.g., 20-30 minutes) or until all prompts have been used. The team with the most points at the end wins. Encourage good sportsmanship and cheering for all participants."
                ],
                stationInstructions: [],
                materials: ["Paper (various)", "Pencils (various)", "Pens (3)", "Washable Markers (various)", "Buckets (various)", "Red Basket (1)", "Scoreboard (1)", "Whistles (2)", "Stopwatch (1)"],
                safety: "Ensure ample space for acting to prevent collisions or falls. Remind children to be mindful of their surroundings and not to get too wild with their movements. Emphasize respectful guessing and sportsmanship. No physical contact between actors and guessers.",
                supercharged: "Charades reminds us that we can communicate powerful messages in many ways, not just with words. God speaks to us through His creation, through His Spirit, and through the actions of others. How can you 'act out' God's love to someone this week without saying a word?",
                deleted: false
            },
            {
                id: 'game18',
                name: "Foursquare Camp Trivia Challenge",
                type: "Team Time",
                location: "Indoor",
                description: "Teams answer trivia questions on camp knowledge, Foursquare history/values, and 'guess the sound' challenges, testing knowledge and quick thinking.",
                objectives: "Enhances knowledge recall, quick thinking, teamwork, and active listening.",
                generalInstructions: [
                    "**Setup:** Prepare a list of trivia questions across various categories: \n- **Camp Facts:** (e.g., 'What is the name of our camp director?', 'How many meals do we eat in a day?', 'What is the camp theme song?'). \n- **Foursquare History/Values:** (e.g., 'What are the four symbols of the Foursquare Gospel?', 'Who founded the Foursquare Church?', 'What does 'Foursquare' mean?'). \n- **Simple Bible Stories/Characters:** (e.g., 'Who built the ark?', 'Who was swallowed by a big fish?', 'What was the first miracle Jesus performed?'). \n- **'Guess the Sound':** (play pre-recorded camp-related sounds like a whistle, a tent zipper, a campfire crackling, a specific animal sound, or a song snippet). \nDivide campers into small teams (e.g., 4-6 players per team). Designate a 'buzzer' system for each team (e.g., a small metal cup to tap, a bell, or simply raising a hand). Have a scorekeeper ready with a scoreboard.",
                    "**Game Play:** The leader reads a question aloud. The first team to 'buzz in' (or raise their hand/tap their buzzer) gets the chance to answer. Set a time limit for answering (e.g., 10-15 seconds). If they answer correctly, they earn points (e.g., 1 point per question). If they answer incorrectly, the other teams get a chance to 'steal' by buzzing in. If no team answers correctly, the leader reveals the answer and moves to the next question.",
                    "**Scoring:** Keep score on a whiteboard or large paper. You can assign different point values for different categories or difficulty levels (e.g., 1 point for easy, 2 for medium, 3 for hard).",
                    "**Winning:** The game continues for a set number of rounds (e.g., 10-15 questions) or a predetermined time limit (e.g., 30 minutes). The team with the most points at the end wins. Encourage good sportsmanship and cheering for all participants, regardless of score."
                ],
                stationInstructions: [],
                materials: ["Paper (various)", "Pencils (various)", "Pens (3)", "Washable Markers (various)", "Scoreboard (1)", "Small Metal Cups (6)", "Flash Cards (60)", "Whistles (2)", "Stopwatch (1)", "Sound device (e.g., phone/speaker for 'guess the sound' if applicable)", "Pre-recorded sounds (if using 'Guess the Sound')"],
                safety: "Ensure the area is clear and organized. Remind children to be respectful when others are answering and to wait for their turn to buzz in. No pushing or shoving to get to the buzzer. Ensure the volume for sound clips is appropriate and not too loud.",
                supercharged: "Trivia challenges our knowledge, just as studying the Bible helps us grow in our understanding of God and His truth. The more we learn about Him, the better equipped we are to live for Him. What new things did you learn about God or the Foursquare Church today?",
                deleted: false
            },
            {
                id: 'game19',
                name: "Catapult Challenge",
                type: "Team Time",
                location: "Indoor",
                description: "Teams design and build their own small catapults using provided materials, then compete in challenges like launching projectiles for distance or accuracy.",
                objectives: "Fosters engineering design, problem-solving, precision, and friendly competition.",
                generalInstructions: [
                    "**Setup:** Designate a building area for each team. Provide each team with a kit of materials for building a small catapult. Common materials include: popsicle sticks, rubber bands (various thicknesses), plastic spoons (as the launching arm), plastic cups (as projectile holders), glue sticks, white glue, and scissors. Also, provide various soft, safe projectiles (e.g., cotton balls, small plastic balls, crumpled paper, small clay balls). Prepare a clear launching zone and target areas for the competition phase.",
                    "**Team Formation:** Divide campers into small teams (e.g., 3-5 players per team). Present the challenge: to design and build a functional catapult that can launch a projectile.",
                    "**Build Time (30-40 minutes):** Teams have this time to brainstorm, design, and construct their catapult. Encourage them to experiment with different designs and test their catapults during the building phase. Leaders should circulate to offer guidance and ensure safe construction.",
                    "**Competition Challenges:** Once the building time is up, teams will bring their catapults to a designated competition area and compete in one or more challenges: \n- **Distance Challenge:** Each team launches a projectile from a designated line, aiming for the furthest distance. Mark the landing spots and measure the distance. Each team gets 3-5 attempts. \n- **Accuracy Challenge:** Set up targets (e.g., buckets, hula hoops, marked circles on the floor) at various distances. Teams try to land projectiles inside the targets for points. Assign different point values for different targets/distances. Each team gets 3-5 attempts. \n- **Volume Challenge:** Teams try to launch as many projectiles as possible into a container within a set time (e.g., 60 seconds).",
                    "**Scoring:** Points are awarded based on performance in the chosen challenges (e.g., furthest distance in feet/meters, most accurate shots, most projectiles in the bucket). Keep a clear score for each team on a scoreboard.",
                    "**Winning:** The team with the highest total score across all challenges wins. Celebrate all efforts, regardless of score."
                ],
                stationInstructions: [],
                materials: ["Popsicle Sticks (various)", "Rubber Bands (various)", "Plastic Spoons (36)", "Plastic Cups (100)", "Small Plastic Balls (2 bags)", "Cotton Balls (suggested purchase)", "Paper Clips (suggested purchase)", "Clay (suggested purchase)", "Glue Sticks (various)", "White Glue Bottles (11)", "Scissors (various)", "Stopwatch (1)", "Measuring Tape (suggested purchase)", "Cones (for marking lines/targets)", "Buckets (various)", "Hula Hoops (25)"],
                safety: "Emphasize aiming only at designated targets, never at people. Projectiles should always be soft and harmless. Supervise the building process carefully, especially when using scissors or glue. Ensure the launching area is clear and that no one is standing in the path of projectiles. Remind children not to 'overload' or misuse the catapults in a dangerous way.",
                supercharged: "Building and launching catapults teaches us about design, precision, and cause-and-effect. In our faith, we are called to be intentional in our actions, knowing that our efforts, when guided by God, can have a far-reaching impact. What 'impact' do you want to make for God's kingdom, and what steps can you take to 'launch' into that purpose?",
                deleted: false
            },
            {
                id: 'game20',
                name: "Giant Checkers Tournament",
                type: "Team Time",
                location: "Indoor",
                description: "Teams strategize and play a large-scale game of checkers, with campers moving as the pieces, fostering logical thinking and collaborative strategy.",
                objectives: "Enhances strategic thinking, logical reasoning, teamwork, and communication.",
                generalInstructions: [
                    "**Setup:** Set up the giant checkers board in a clear, open indoor area (e.g., gym floor, large hall). Ensure there is enough space around the board for players to move. If using campers as pieces, ensure they understand their role and boundaries. Each team will need a designated 'holding area' for their captured pieces.",
                    "**Team Formation:** Divide campers into two teams. Each team will be one color of checkers (e.g., Red Team, Black Team). Assign 6-8 players from each team to be the 'checkers' (they will physically move on the board when instructed by their team). The remaining players will be the 'strategists' who help decide moves from the sidelines. Rotate roles between games.",
                    "**Checkers Rules:** \n- Pieces move diagonally forward one square at a time. \n- To capture an opponent's piece, a player must jump over it diagonally to an empty square immediately beyond. The captured piece is removed from the board and goes to the capturing team's 'holding area'. \n- If a player reaches the opponent's back row, their piece is 'crowned' (e.g., another piece is placed on top of it, or they wear a special hat/sash), and it can then move both forward and backward diagonally. \n- Players *must* take a jump if one is available. If multiple jumps are available, they can choose which one to take. \n- No jumping over your own pieces. \n- Pieces cannot move backward unless crowned.",
                    "**Winning:** The game ends when one team has captured all of the opponent's pieces, or when the opponent has no legal moves left. The team that successfully eliminates or blocks the other team wins the round. Play multiple rounds for a tournament format, ensuring all teams get a chance to play."
                ],
                stationInstructions: [],
                materials: ["Giant Checkers Game (at Parkside - assume available)", "Cones (various)", "Whistles (2)", "Stopwatch (1)", "Small hats/sashes (for 'crowned' pieces - suggested purchase)"],
                safety: "Ensure players move carefully on the board, especially when jumping over other players (if campers are pieces). Remind children to not run, push, or shove. Supervise closely to ensure fair play and prevent any accidental falls. Ensure the board surface is non-slip. Clearly communicate rules regarding physical contact and safe movement.",
                supercharged: "Playing giant checkers teaches us about strategy and foresight. In our faith, we are called to be wise and thoughtful, making choices that align with God's plan. Sometimes we need to sacrifice something small for a bigger victory, just like moving a checker piece. How can you be more strategic in your walk with God?",
                deleted: false
            }
        ];

        // Define the schedule data from the PDF and image, including team rotations for non-droppable slots
        const scheduleDataFromPDF = {
            'TUES': {
                '10:10-11:10': {
                    'ROCKWALL': '', // Blocked out - no teams
                    'ARCHERY': '', // Blocked out - no teams
                    'TEAM TIME': 'Team 1, Team 3', 
                    'POOL': 'Team 2', // Corrected
                    'CREATION STATION': 'Team 4', 
                    'FIELD': 'Team 5, Team 7',
                    'GAMES & CHILL': 'Team 6, Team 8'
                },
                '1:25-2:25': {
                    'ROCKWALL': 'Team 1',
                    'ARCHERY': 'Team 6',
                    'TEAM TIME': 'Team 2, Team 7',
                    'POOL': '', // Blocked out - no teams
                    'CREATION STATION': '', // Blocked out - no teams
                    'FIELD': 'Team 3, Team 8',
                    'GAMES & CHILL': 'Team 4, Team 5'
                },
                '4:20-5:20': {
                    'ROCKWALL': 'Team 8',
                    'ARCHERY': 'Team 4',
                    'TEAM TIME': '', // Blocked out - no teams
                    'POOL': 'Team 1',
                    'CREATION STATION': 'Team 5',
                    'FIELD': 'Team 2, Team 6',
                    'GAMES & CHILL': 'Team 3, Team 7'
                }
            },
            'WED': {
                '10:10-11:10': {
                    'ROCKWALL': 'Team 2',
                    'ARCHERY': 'Team 3',
                    'TEAM TIME': 'Team 6, Team 5',
                    'POOL': 'Team 8',
                    'CREATION STATION': 'Team 7',
                    'FIELD': 'Team 1, Team 4',
                    'GAMES & CHILL': '', // Blocked out - no teams
                },
                '1:25-2:25': { 
                    'CAMP CARNIVAL': 'CAMP CARNIVAL'
                },
                '4:20-5:20': {
                    'ROCKWALL': 'Team 7',
                    'ARCHERY': 'Team 5',
                    'TEAM TIME': 'Team 4, Team 8',
                    'POOL': 'Team 6',
                    'CREATION STATION': 'Team 3',
                    'FIELD': '', // Blocked out - no teams
                    'GAMES & CHILL': 'Team 1, Team 2'
                }
            },
            'THUR': {
                '10:10-11:10': {
                    'ROCKWALL': 'Team 3',
                    'ARCHERY': 'Team 7',
                    'TEAM TIME': '', // Blocked out - no teams
                    'POOL': 'Team 4',
                    'CREATION STATION': 'Team 8',
                    'FIELD': 'Team 1, Team 5',
                    'GAMES & CHILL': 'Team 2, Team 6'
                },
                '1:25-2:25': {
                    'ROCKWALL': '', // Blocked out - no teams
                    'ARCHERY': '', // Blocked out - no teams
                    'TEAM TIME': 'Team 8, Team 2',
                    'POOL': 'Team 3',
                    'CREATION STATION': 'Team 1',
                    'FIELD': 'Team 4, Team 6',
                    'GAMES & CHILL': 'Team 5, Team 7'
                },
                '4:20-5:20': {
                    'ROCKWALL': 'Team 5',
                    'ARCHERY': 'Team 8',
                    'TEAM TIME': 'Team 1, Team 6',
                    'POOL': '', // Blocked out - no teams
                    'CREATION STATION': '', // Blocked out - no teams
                    'FIELD': 'Team 2, Team 7',
                    'GAMES & CHILL': 'Team 3, Team 4'
                }
            },
            'FRI': {
                '10:10-11:10': {
                    'ROCKWALL': 'Team 4',
                    'ARCHERY': 'Team 2',
                    'TEAM TIME': 'Team 7, Team 3',
                    'POOL': 'Team 5',
                    'CREATION STATION': 'Team 6',
                    'FIELD': '', // Blocked out - no teams
                    'GAMES & CHILL': 'Team 8, Team 1'
                },
                '1:25-2:25': { 
                    'POINTS PALOOZA': 'POINTS PALOOZA'
                },
                '4:20-5:20': { 
                    'ROCKWALL': 'Team 6',
                    'ARCHERY': 'Team 1',
                    'TEAM TIME': 'Team 5, Team 4',
                    'POOL': 'Team 7',
                    'CREATION STATION': 'Team 2',
                    'FIELD': 'Team 8, Team 3',
                    'GAMES & CHILL': '', // Blocked out - no teams
                }
            }
        };

        // Define the color mapping for each team
        const teamColors = {
            'Team 1': 'team-1', // red-700
            'Team 2': 'team-2', // blue-700
            'Team 3': 'team-3', // teal-700
            'Team 4': 'team-4', // purple-700
            'Team 5': 'team-5', // orange-700
            'Team 6': 'team-6', // indigo-700
            'Team 7': 'team-7', // pink-700
            'Team 8': 'team-8'  // emerald-700
        };


        // Define the structure of the calendar grid for dynamic generation
        const calendarGridStructure = [
            // Header row (empty cell + activity types)
            { type: 'header', label: '' },
            { type: 'header', label: 'ROCKWALL' },
            { type: 'header', label: 'ARCHERY' },
            { type: 'header', label: 'TEAM TIME' },
            { type: 'header', label: 'POOL' },
            { type: 'header', label: 'CREATION STATION' },
            { type: 'header', label: 'FIELD' },
            { type: 'header', label: 'GAMES & CHILL' },

            // TUESDAY
            { type: 'time-slot', day: 'TUES', timeSlot: '10:10-11:10', label: 'TUES<br>Activity 1<br>10:10-11:10' },
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'ROCKWALL', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'ARCHERY', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'TUES', timeSlot: '10:10-11:10', slotCategory: 'GAMES & CHILL', isDroppable: false },

            { type: 'time-slot', day: 'TUES', timeSlot: '1:25-2:25', label: 'TUES<br>Activity 2<br>1:25-2:25' },
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'POOL', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'CREATION STATION', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'TUES', timeSlot: '1:25-2:25', slotCategory: 'GAMES & CHILL', isDroppable: false },

            { type: 'time-slot', day: 'TUES', timeSlot: '4:20-5:20', label: 'TUES<br>Activity 3<br>4:20-5:20' },
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'TEAM TIME', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'TUES', timeSlot: '4:20-5:20', slotCategory: 'GAMES & CHILL', isDroppable: false },

            // WEDNESDAY
            { type: 'time-slot', day: 'WED', timeSlot: '10:10-11:10', label: 'WED<br>Activity 1<br>10:10-11:10' },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'WED', timeSlot: '10:10-11:10', slotCategory: 'GAMES & CHILL', isDroppable: false }, // Blocked out
            
            { type: 'time-slot', day: 'WED', timeSlot: '1:25-2:25', label: 'WED<br>Activity 2<br>1:25-2:25' },
            { type: 'activity-slot', day: 'WED', timeSlot: '1:25-2:25', slotCategory: 'CAMP CARNIVAL', isDroppable: false, colspan: 7 },

            { type: 'time-slot', day: 'WED', timeSlot: '4:20-5:20', label: 'WED<br>Activity 3<br>4:20-5:20' },
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'FIELD', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'WED', timeSlot: '4:20-5:20', slotCategory: 'GAMES & CHILL', isDroppable: false },

            // THURSDAY
            { type: 'time-slot', day: 'THUR', timeSlot: '10:10-11:10', label: 'THUR<br>Activity 1<br>10:10-11:10' },
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'TEAM TIME', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'THUR', timeSlot: '10:10-11:10', slotCategory: 'GAMES & CHILL', isDroppable: false },

            { type: 'time-slot', day: 'THUR', timeSlot: '1:25-2:25', label: 'THUR<br>Activity 2<br>1:25-2:25' },
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'ROCKWALL', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'ARCHERY', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'THUR', timeSlot: '1:25-2:25', slotCategory: 'GAMES & CHILL', isDroppable: false },

            { type: 'time-slot', day: 'THUR', timeSlot: '4:20-5:20', label: 'THUR<br>Activity 3<br>4:20-5:20' },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'THUR', timeSlot: '4:20-5:20', slotCategory: 'GAMES & CHILL', isDroppable: false },

            // FRIDAY
            { type: 'time-slot', day: 'FRI', timeSlot: '10:10-11:10', label: 'FRI<br>Activity 1<br>10:10-11:10' },
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'FIELD', isDroppable: false }, // Blocked out
            { type: 'activity-slot', day: 'FRI', timeSlot: '10:10-11:10', slotCategory: 'GAMES & CHILL', isDroppable: false },

            { type: 'time-slot', day: 'FRI', timeSlot: '1:25-2:25', label: 'FRI<br>Activity 2<br>1:25-2:25' },
            { type: 'activity-slot', day: 'FRI', timeSlot: '1:25-2:25', slotCategory: 'POINTS PALOOZA', isDroppable: false, colspan: 7 },

            { type: 'time-slot', day: 'FRI', timeSlot: '4:20-5:20', label: 'FRI<br>Activity 3<br>4:20-5:20' },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'ROCKWALL', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'ARCHERY', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'TEAM TIME', isDroppable: true },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'POOL', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'CREATION STATION', isDroppable: false },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'FIELD', isDroppable: true },
            { type: 'activity-slot', day: 'FRI', timeSlot: '4:20-5:20', slotCategory: 'GAMES & CHILL', isDroppable: false }, // Blocked out
        ];


        // Event listener for when the DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', async () => {
            // Get references to all necessary DOM elements
            const gameGrid = document.getElementById('game-grid');
            const modal = document.getElementById('game-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal');
            const editActivityBtn = document.getElementById('edit-activity-btn'); // New: Edit button
            const typeFilters = document.getElementById('type-filters');
            const locationFilters = document.getElementById('location-filters');
            const materialFilterSelect = document.getElementById('material-filter-select');
            
            // Renamed/repurposed modal and form elements for Add/Edit functionality
            const activityFormModal = document.getElementById('activity-form-modal');
            const activityFormModalTitle = document.getElementById('activity-form-modal-title');
            const closeActivityFormModalBtn = document.getElementById('close-activity-form-modal');
            const activityForm = document.getElementById('activity-form');
            const activityIdInput = document.getElementById('activity-id'); // Hidden input for ID
            const activityFormSubmitBtn = document.getElementById('activity-form-submit-btn'); // Submit button
            
            const generalInstructionsSection = document.getElementById('general-instructions-section');
            const generalInstructionsContainer = document.getElementById('general-instructions-container');
            const addGeneralInstructionBtn = document.getElementById('add-general-instruction-btn');
            
            const stationInstructionsSection = document.getElementById('station-instructions-section');
            const stationInstructionsContainer = document.getElementById('station-instructions-container');
            const addStationInstructionBtn = document.getElementById('add-station-instruction-btn');
            
            const instructionTypeRadios = document.querySelectorAll('input[name="instruction-type"]');

            const materialsContainer = document.getElementById('materials-container');
            const addMaterialBtn = document.getElementById('add-material-btn');
            const loadingIndicator = document.getElementById('loading-indicator');
            const moveToTrashBtn = document.getElementById('move-to-trash-btn');
            const viewDeletedActivitiesBtn = document.getElementById('view-deleted-activities-btn');
            const deletedActivitiesModal = document.getElementById('deleted-activities-modal');
            const closeDeletedActivitiesModalBtn = document.getElementById('close-deleted-activities-modal'); 
            const deletedActivitiesList = document.getElementById('deleted-activities-list');
            const deletedCountSpan = document.getElementById('deleted-count');
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmPermanentDeleteBtn = document.getElementById('confirm-permanent-delete-btn');
            const cancelPermanentDeleteBtn = document.getElementById('cancel-permanent-delete-btn');
            const leaderResourcesToggle = document.getElementById('leader-resources-toggle');
            const leaderResourcesContent = document.getElementById('leader-resources-content');
            const leaderResourcesCollapseIcon = leaderResourcesToggle.querySelector('.collapse-icon');
            const populateInitialGamesBtn = document.getElementById('populate-initial-games-btn');
            const calendarGridContainer = document.getElementById('calendar-grid-container');
            const calendarInstructionsToggle = document.getElementById('calendar-instructions-toggle');
            const calendarInstructionsContent = document.getElementById('calendar-instructions-content');
            const calendarInstructionsCollapseIcon = calendarInstructionsToggle.querySelector('.collapse-icon');
            const activityManagementToggle = document.getElementById('activity-management-toggle');
            const activityManagementContent = document.getElementById('activity-management-content');
            const activityManagementCollapseIcon = activityManagementToggle.querySelector('.collapse-icon');
            const addActivityCard = document.getElementById('add-activity-card'); // Get reference to the add activity card


            // Object to store current filter selections
            let currentFilters = { type: 'all', location: 'all', material: 'all' };

            // Initialize Firebase
            try {
                // Check if Firebase configuration is provided. If not, the default placeholder will be used.
                if (!firebaseConfig.projectId || firebaseConfig.projectId === "YOUR_PROJECT_ID") {
                    console.warn("Firebase configuration is using placeholder values. Please update firebaseConfig with your actual project details for full functionality on GitHub.");
                    loadingIndicator.textContent = "Firebase not fully configured. Displaying initial activities only. Please check console for instructions.";
                    // Fallback to initial games if Firebase config is not properly set
                    allActivities = [...initialGamesData];
                    renderGames();
                    populateMaterialFilter();
                    updateActivityChart();
                    updateDeletedCount();
                    renderCalendarGrid(); // Render calendar even without full Firebase
                    setupCalendarClickListeners(); // Setup click listeners
                    return; // Exit early if config is not set
                }

                app = initializeApp(firebaseConfig); // Initialize Firebase app
                db = getFirestore(app); // Get Firestore instance
                auth = getAuth(app); // Get Auth instance

                // Listen for authentication state changes
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // If user is already signed in (e.g., from a previous session or custom token)
                        userId = user.uid; 
                    } else {
                        // If no user, attempt anonymous sign-in
                        try {
                            await signInAnonymously(auth);
                            userId = auth.currentUser.uid; // Store anonymous user ID
                        } catch (anonError) {
                            console.error("Firebase anonymous authentication failed, falling back to initial data only:", anonError);
                            userId = null; // Explicitly set userId to null if auth fails
                        }
                    }
                    // Attach the form submission listener here, after db is initialized and auth state is known
                    // Use { once: true } to ensure the listener is only added once
                    activityForm.addEventListener('submit', async (e) => {
                        e.preventDefault(); // Prevent default form submission

                        const formData = new FormData(e.target); // Get form data
                        const activityId = formData.get('id'); // Get the ID for edit operations

                        // Determine instruction type and collect data accordingly
                        const instructionType = formData.get('instruction-type');
                        let generalInstructions = [];
                        let stationInstructions = [];

                        if (instructionType === 'general') {
                            generalInstructions = Array.from(document.querySelectorAll('#general-instructions-container textarea[name="generalInstructions[]"]')).map(el => el.value).filter(val => val.trim() !== '');
                        } else if (instructionType === 'station') {
                            const stationTitles = Array.from(document.querySelectorAll('#station-instructions-container input[name="stationTitles[]"]')).map(el => el.value);
                            const stationContents = Array.from(document.querySelectorAll('#station-instructions-container textarea[name="stationContents[]"]')).map(el => el.value);
                            
                            // Combine titles and contents into an array of objects
                            stationInstructions = stationTitles.map((title, index) => ({
                                title: title,
                                content: stationContents[index] || ''
                            })).filter(station => station.title.trim() !== '' || station.content.trim() !== ''); // Filter out empty stations
                        }

                        const activityData = {
                            name: formData.get('name'),
                            type: formData.get('type'),
                            location: formData.get('location'),
                            objectives: formData.get('objectives'),
                            safety: formData.get('safety'),
                            supercharged: formData.get('supercharged'),
                            materials: Array.from(document.querySelectorAll('#materials-container input[name="materials[]"]')).map(el => el.value).filter(val => val.trim() !== ''),
                            description: formData.get('objectives').substring(0, 100) + '...', // Use objectives as a short description
                            deleted: false, // New/edited activities are not deleted
                            generalInstructions: generalInstructions, // Save general instructions
                            stationInstructions: stationInstructions // Save station instructions
                        };

                        // Basic client-side validation for required fields
                        if (!activityData.name || !activityData.type || !activityData.location || !activityData.objectives || !activityData.safety || !activityData.supercharged) {
                            console.error("Validation failed: Please fill in all required fields (marked with *).");
                            return;
                        }
                        // Validate instructions based on type
                        if (instructionType === 'general' && activityData.generalInstructions.length === 0) {
                            console.error("Validation failed: Please add at least one general instruction step.");
                            return;
                        }
                        if (instructionType === 'station' && activityData.stationInstructions.length === 0) {
                            console.error("Validation failed: Please add at least one station instruction.");
                            return;
                        }

                        try {
                            if (db) {
                                if (activityId) {
                                    // Edit existing activity
                                    const activityRef = doc(db, `artifacts/${appId}/public/data/activities`, activityId);
                                    await updateDoc(activityRef, activityData);
                                    console.log("Activity updated successfully!");
                                } else {
                                    // Add new activity
                                    const docRef = await addDoc(collection(db, `artifacts/${appId}/public/data/activities`), activityData);
                                    console.log("Activity added successfully with ID: ", docRef.id);
                                }
                                activityFormModal.classList.remove('active'); // Close the modal on success
                                activityForm.reset(); // Reset the form
                                // The onSnapshot listener will automatically update the UI
                            } else {
                                console.error("Firestore not initialized. Activity not saved/updated.");
                            }
                        } catch (error) {
                            console.error("Error saving/updating document to Firestore: ", error);
                        }
                    }, { once: true }); // Attach this listener only once

                    // Start listening for activities only after authentication is ready
                    listenForActivities();
                    listenForScheduledActivities(); // Start listening for scheduled activities
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                loadingIndicator.textContent = "Error loading activities. Please ensure Firebase config is correct and security rules are set up.";
                // Fallback to initial games if Firebase init fails
                userId = null; // Ensure userId is null if Firebase itself fails to initialize
                allActivities = [...initialGamesData]; // Display initial games in offline mode
                renderGames();
                populateMaterialFilter(); // Ensure materials are populated even in offline mode
                updateActivityChart();
                updateDeletedCount();
                renderCalendarGrid(); // Render calendar even in offline mode
                setupCalendarClickListeners(); // Setup click listeners
            }

            /**
             * Sets up a real-time listener for activities from Firestore.
             * Merges initial static data with user-specific data from Firestore.
             */
            function listenForActivities() {
                // If Firebase DB is not available (e.g., initialization failed),
                // we only display the initial static data.
                if (!db) {
                    console.warn("Firestore not ready for listening. Displaying initial data only.");
                    allActivities = [...initialGamesData];
                    renderGames();
                    populateMaterialFilter();
                    updateActivityChart();
                    updateDeletedCount();
                    return;
                }
                
                // IMPORTANT CHANGE: Using a public collection for shared data
                // This path allows all authenticated users to read/write to the same activity list.
                const activitiesCollectionRef = collection(db, `artifacts/${appId}/public/data/activities`);
                const q = query(activitiesCollectionRef); // Create a query for the collection

                // Set up the real-time listener
                onSnapshot(q, (snapshot) => {
                    loadingIndicator.style.display = 'none'; // Hide loading indicator once data is received
                    const fetchedGames = [];
                    snapshot.forEach(doc => {
                        fetchedGames.push({ id: doc.id, ...doc.data() }); // Extract document ID and data
                    });

                    // Merge initial games with fetched games, prioritizing fetched games by ID if duplicates exist
                    const mergedGamesMap = new Map();
                    initialGamesData.forEach(game => mergedGamesMap.set(game.id, game));
                    fetchedGames.forEach(game => mergedGamesMap.set(game.id, game));
                    
                    allActivities = Array.from(mergedGamesMap.values());
                    
                    // Update UI components after data is loaded/updated
                    renderGames();
                    populateMaterialFilter(); // IMPORTANT: Call this after allActivities is updated
                    updateActivityChart();
                    updateDeletedCount();
                }, (error) => {
                    console.error("Error fetching activities from Firestore:", error);
                    loadingIndicator.textContent = "Failed to load user activities. Displaying initial games. Please check console for Firebase errors (often security rules related).";
                    // Fallback to initial games if Firestore fetch fails
                    allActivities = [...initialGamesData];
                    renderGames();
                    populateMaterialFilter();
                    updateActivityChart();
                    updateDeletedCount();
                });
            }

            /**
             * Extracts and returns a sorted list of unique materials from all activities.
             */
            function getUniqueMaterials() {
                const allMaterials = new Set();
                allActivities.forEach(game => {
                    if (game.materials && Array.isArray(game.materials)) {
                        game.materials.forEach(material => {
                            // Normalize material names (e.g., "Water Guns (14)" becomes "Water Guns")
                            const normalizedMaterial = material.split('(')[0].trim();
                            if (normalizedMaterial) {
                                allMaterials.add(normalizedMaterial);
                            }
                        });
                    }
                });
                return Array.from(allMaterials).sort((a, b) => a.localeCompare(b)); // Sort alphabetically
            }

            /**
             * Populates the material filter dropdown with unique materials.
             * Preserves the currently selected option if it's still valid.
             */
            function populateMaterialFilter() {
                const uniqueMaterials = getUniqueMaterials();
                const currentSelectedMaterial = materialFilterSelect.value; // Save current selection
                materialFilterSelect.innerHTML = '<option value="all">All Materials</option>'; // Reset options

                // Add unique materials as options
                uniqueMaterials.forEach(material => {
                    const option = document.createElement('option');
                    option.value = material;
                    option.textContent = material;
                    materialFilterSelect.appendChild(option);
                });

                // Restore the previous selection if it still exists in the new list
                if (uniqueMaterials.includes(currentSelectedMaterial)) {
                    materialFilterSelect.value = currentSelectedMaterial;
                } else {
                    materialFilterSelect.value = 'all'; // Default to 'All' if previous selection is no longer valid
                }
            }

            /**
             * Renders activity cards in the game grid based on current filters.
             * Includes an "Add New Activity" card.
             */
            function renderGames() {
                gameGrid.innerHTML = ''; // Clear existing cards
                
                // Filter activities based on type, location, material, and deleted status
                const filteredGames = allActivities.filter(game => {
                    const notDeleted = !game.deleted; // Only show non-deleted activities
                    const typeMatch = currentFilters.type === 'all' || game.type === currentFilters.type;
                    // 'Both' location matches both 'Outdoor' and 'Indoor' filters
                    const locationMatch = currentFilters.location === 'all' || game.location === currentFilters.location || game.location === 'Both';
                    
                    let materialMatch = true;
                    if (currentFilters.material !== 'all') {
                        // Check if any of the game's materials match the selected material filter
                        materialMatch = game.materials && Array.isArray(game.materials) && game.materials.some(material => 
                            material.split('(')[0].trim() === currentFilters.material
                        );
                    }
                    
                    return notDeleted && typeMatch && locationMatch && materialMatch;
                });

                // Create and append a card for each filtered game
                filteredGames.forEach((game) => {
                    const card = document.createElement('div');
                    card.className = 'game-card bg-white rounded-xl shadow-sm border border-stone-200 p-6 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex flex-col';
                    card.dataset.gameId = game.id; // Store game ID for easy retrieval
                    card.dataset.activityType = game.type; // Store activity type for scheduling validation
                    
                    // Add 'selected' class if this card is currently selected
                    if (selectedActivityForSchedule && selectedActivityForSchedule.id === game.id) {
                        card.classList.add('selected');
                    }

                    // Determine card color based on activity type
                    const typeColor = game.type === 'Field Game' ? 'bg-sky-100 text-sky-800' : 'bg-amber-100 text-amber-800';
                    // Determine location icon
                    const locationIcon = game.location === 'Outdoor' ? '☀️' : game.location === 'Indoor' ? '🏠' : '☀️/🏠';

                    card.innerHTML = `
                        <div class="flex-grow">
                            <div class="flex justify-between items-start mb-3">
                                <span class="text-xs font-bold py-1 px-3 rounded-full ${typeColor}">${game.type || 'N/A'}</span>
                                <span class="text-xl">${locationIcon}</span>
                            </div>
                            <h3 class="text-xl font-bold text-teal-700 mb-2">${game.name || 'Untitled Activity'}</h3>
                            <p class="text-stone-600 text-sm">${game.description || (game.objectives ? game.objectives.substring(0, 100) + '...' : 'No description available.')}</p>
                        </div>
                        <button class="mt-4 w-full bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition-colors view-details-btn">View Details</button>
                    `;
                    gameGrid.appendChild(card);
                    
                    // Add click listener to the card for selection
                    card.addEventListener('click', (e) => {
                        // If the "View Details" button was clicked, handle that specifically
                        if (e.target.classList.contains('view-details-btn')) {
                            showGameDetails(game.id);
                        } else {
                            // Otherwise, it's a click on the card for selection
                            toggleActivitySelection(game.id);
                        }
                    });

                    // Apply card entry animation
                    requestAnimationFrame(() => {
                        card.classList.add('card-enter');
                        requestAnimationFrame(() => {
                            card.classList.add('card-enter-active');
                        });
                    });
                });

                // Add the "Add New Activity" card at the end of the grid
                const addActivityCard = document.createElement('div');
                addActivityCard.className = 'bg-emerald-100 rounded-xl shadow-sm border border-emerald-300 p-6 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex flex-col items-center justify-center text-center h-48'; // Fixed height for consistency
                addActivityCard.id = 'add-activity-card';
                addActivityCard.innerHTML = `
                    <div class="text-emerald-700 text-6xl mb-4">+</div>
                    <h3 class="text-xl font-bold text-emerald-700">Add New Activity</h3>
                    <p class="text-emerald-600 text-sm mt-2">Create a custom activity for your camp!</p>
                `;
                gameGrid.appendChild(addActivityCard);

                // Add click listener to the "Add New Activity" card
                addActivityCard.addEventListener('click', () => {
                    openActivityFormModal(); // Open modal for adding
                });
            }

            /**
             * Toggles the selection of an activity for scheduling.
             * Highlights the selected card and updates `selectedActivityForSchedule`.
             */
            function toggleActivitySelection(gameId) {
                const previouslySelectedCard = document.querySelector('.game-card.selected');
                if (previouslySelectedCard) {
                    previouslySelectedCard.classList.remove('selected');
                }

                if (selectedActivityForSchedule && selectedActivityForSchedule.id === gameId) {
                    // If the same card is clicked again, deselect it
                    selectedActivityForSchedule = null;
                } else {
                    // Select the new card
                    const newSelectedCard = document.querySelector(`.game-card[data-game-id="${gameId}"]`);
                    if (newSelectedCard) {
                        newSelectedCard.classList.add('selected');
                        selectedActivityForSchedule = allActivities.find(g => g.id === gameId);
                    }
                }
                // Update calendar slot highlights based on new selection
                updateCalendarSlotHighlights();
            }

            /**
             * Updates the highlighting of calendar slots based on the currently selected activity.
             */
            function updateCalendarSlotHighlights() {
                document.querySelectorAll('.calendar-slot.droppable').forEach(slot => {
                    slot.classList.remove('highlight-drop', 'invalid-drop'); // Clear previous highlights

                    if (selectedActivityForSchedule) {
                        const slotCategory = slot.dataset.slotCategory;
                        const mappedActivityTypeForSlot = selectedActivityForSchedule.type === 'Field Game' ? 'FIELD' : selectedActivityForSchedule.type === 'Team Time' ? 'TEAM TIME' : null;

                        if (mappedActivityTypeForSlot === slotCategory) {
                            slot.classList.add('highlight-drop');
                        } else {
                            slot.classList.add('invalid-drop');
                        }
                    }
                });
            }

            /**
             * Displays the detailed information of a selected game in a modal.
             * @param {string} gameId - The ID of the game to display.
             */
            function showGameDetails(gameId) {
                const game = allActivities.find(g => g.id == gameId);
                if (!game) return; // Exit if game not found

                modalTitle.textContent = game.name || 'Activity Details';
                
                // Generate HTML for materials list
                let materialsHTML = game.materials && Array.isArray(game.materials) && game.materials.length > 0 ? game.materials.map(item => `<li class="bg-stone-100 py-1 px-3 rounded-md">${item}</li>`).join('') : '<p class="text-stone-700">No specific materials listed.</p>';
                
                let instructionsContent = '';

                // Render general instructions if available
                if (game.generalInstructions && Array.isArray(game.generalInstructions) && game.generalInstructions.length > 0) {
                    instructionsContent += `
                        <div>
                            <h4 class="text-lg font-bold text-teal-700 mb-2">⚙️ General Instructions</h4>
                            <ol class="list-decimal list-inside space-y-2 text-stone-700">
                                ${game.generalInstructions.map(step => `<li>${marked.parse(step)}</li>`).join('')}
                            </ol>
                        </div>
                    `;
                }

                // Render station-specific instructions if available
                if (game.stationInstructions && Array.isArray(game.stationInstructions) && game.stationInstructions.length > 0) {
                    // Add a header for general instructions if both types are present
                    if (instructionsContent !== '') {
                        instructionsContent += `<div class="mt-6"><h4 class="text-lg font-bold text-teal-700 mb-2">Stations Breakdown</h4></div>`;
                    } else {
                        instructionsContent += `<div><h4 class="text-lg font-bold text-teal-700 mb-2">⚙️ Station Instructions</h4></div>`;
                    }
                    instructionsContent += `
                        <div class="space-y-4">
                            ${game.stationInstructions.map(station => `
                                <div class="bg-stone-50 p-4 rounded-lg border border-stone-200">
                                    <h5 class="text-md font-semibold text-teal-600 mb-2">${station.title || 'Untitled Station'}</h5>
                                    ${marked.parse(station.content || '<p class="text-stone-700">No content for this station.</p>')}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // If neither instruction type is present
                if (instructionsContent === '') {
                    instructionsContent += `<div><h4 class="text-lg font-bold text-teal-700 mb-2">⚙️ Instructions</h4><p class="text-stone-700">No instructions available.</p></div>`;
                }


                // Populate modal content
                modalContent.innerHTML = `
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-bold text-teal-700 mb-2">🎯 Objectives</h4>
                            <p class="text-stone-700">${marked.parse(game.objectives || 'No objectives listed.')}</p>
                        </div>
                        ${instructionsContent}
                         <div>
                            <h4 class="text-lg font-bold text-teal-700 mb-2">📦 Materials Needed</h4>
                            <ul class="flex flex-wrap gap-2 text-sm text-stone-800">
                                ${materialsHTML}
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-teal-700 mb-2">⚠️ Safety Notes</h4>
                            <p class="text-stone-700">${marked.parse(game.safety || 'No safety notes listed.')}</p>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-teal-700 mb-2">⚡ SuperCharged Application</h4>
                            <p class="text-stone-700 italic">${marked.parse(game.supercharged || 'No SuperCharged application listed.')}</p>
                        </div>
                    </div>
                `;
                moveToTrashBtn.dataset.gameId = gameId; // Set the game ID on the trash button for later use
                editActivityBtn.dataset.gameId = gameId; // Set the game ID on the edit button
                modal.classList.add('active'); // Show the modal
            }

            // Close Game Details Modal via 'X' button
            closeModalBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });
            // Close Game Details Modal via outside click on the overlay
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });

            /**
             * Handles clicks on filter buttons (Type and Location).
             * Updates the current filter and re-renders games.
             * @param {Event} e - The click event object.
             * @param {string} filterType - 'type' or 'location'.
             */
            function handleFilterClick(e, filterType) {
                 if (e.target.tagName !== 'BUTTON') return; // Only process button clicks

                const value = e.target.dataset[filterType]; // Get the data-type or data-location value
                currentFilters[filterType] = value; // Update the current filter

                const filterGroup = e.target.parentElement;
                // Remove active styling from all buttons in the group
                filterGroup.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('bg-teal-600', 'text-white');
                    btn.classList.add('bg-stone-200', 'text-stone-700');
                });
                // Add active styling to the clicked button
                e.target.classList.add('bg-teal-600', 'text-white');
                e.target.classList.remove('bg-stone-200', 'text-stone-700');
                
                renderGames(); // Re-render games with new filters
            }

            // Event listeners for Type and Location filter buttons
            typeFilters.addEventListener('click', (e) => handleFilterClick(e, 'type'));
            locationFilters.addEventListener('click', (e) => handleFilterClick(e, 'location'));
            
            // Event listener for Material filter dropdown change
            materialFilterSelect.addEventListener('change', (e) => {
                currentFilters.material = e.target.value; // Update material filter
                renderGames(); // Re-render games with new material filter
            });

            /**
             * Updates the doughnut chart with current activity type counts.
             * Initializes the chart if it doesn't exist.
             */
            function updateActivityChart() {
                // Only count non-deleted activities for the chart
                const activeActivities = allActivities.filter(g => !g.deleted);
                const fieldGameCount = activeActivities.filter(g => g.type === 'Field Game').length;
                const teamTimeCount = activeActivities.filter(g => g.type === 'Team Time').length;

                if (activityTypeChart) {
                    // If chart already exists, update its data
                    activityTypeChart.data.datasets[0].data = [fieldGameCount, teamTimeCount];
                    activityTypeChart.update();
                } else {
                    // If chart doesn't exist, create a new one
                    const ctx = document.getElementById('activityTypeChart').getContext('2d');
                    activityTypeChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Field Games', 'Team Time'],
                            datasets: [{
                                label: 'Activity Types',
                                data: [fieldGameCount, teamTimeCount],
                                backgroundColor: [
                                    'rgb(14 116 144)', // teal-700
                                    'rgb(217 119 6)'   // amber-600
                                ],
                                borderColor: [
                                    '#ffffff',
                                    '#ffffff'
                                ],
                                borderWidth: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        font: {
                                            family: 'Inter',
                                            size: 14,
                                        },
                                        color: '#44403c' // stone-700
                                    }
                                }
                            },
                            cutout: '60%'
                        }
                    });
                }
            }
            
            // --- Add/Edit Activity Modal Logic ---

            // Event listener for the "Edit Activity" button in the Game Details Modal
            editActivityBtn.addEventListener('click', (e) => {
                const gameId = e.target.dataset.gameId;
                const gameToEdit = allActivities.find(g => g.id === gameId);
                if (gameToEdit) {
                    openActivityFormModal(gameToEdit); // Open modal for editing
                    modal.classList.remove('active'); // Close the details modal
                }
            });

            /**
             * Opens the activity form modal, either for adding a new activity
             * or editing an existing one.
             * @param {Object} [activityToEdit=null] - The activity object to edit. If null, opens for adding.
             */
            function openActivityFormModal(activityToEdit = null) {
                activityForm.reset(); // Always reset the form first

                // Set modal title and submit button text
                if (activityToEdit) {
                    activityFormModalTitle.textContent = 'Edit Activity';
                    activityFormSubmitBtn.textContent = 'Save Changes';
                    activityIdInput.value = activityToEdit.id; // Set hidden ID for editing

                    // Populate form fields with activity data
                    document.getElementById('activity-name').value = activityToEdit.name || '';
                    document.querySelector(`input[name="type"][value="${activityToEdit.type}"]`).checked = true;
                    document.querySelector(`input[name="location"][value="${activityToEdit.location}"]`).checked = true;
                    document.getElementById('objectives').value = activityToEdit.objectives || '';
                    document.getElementById('safety-notes').value = activityToEdit.safety || '';
                    document.getElementById('supercharged-app').value = activityToEdit.supercharged || '';

                    // Populate materials
                    materialsContainer.innerHTML = ''; // Clear existing
                    if (activityToEdit.materials && activityToEdit.materials.length > 0) {
                        activityToEdit.materials.forEach(material => addMaterialField(material));
                    } else {
                        addMaterialField(); // Add one empty field if no materials
                    }

                    // Populate instructions based on type, prioritizing station instructions if present
                    generalInstructionsContainer.innerHTML = ''; // Clear existing
                    stationInstructionsContainer.innerHTML = ''; // Clear existing

                    const hasStationInstructions = activityToEdit.stationInstructions && activityToEdit.stationInstructions.length > 0;
                    const hasGeneralInstructions = activityToEdit.generalInstructions && activityToEdit.generalInstructions.length > 0;

                    if (hasStationInstructions) {
                        document.querySelector('input[name="instruction-type"][value="station"]').checked = true;
                        generalInstructionsSection.classList.add('hidden');
                        stationInstructionsSection.classList.remove('hidden');
                        activityToEdit.stationInstructions.forEach(station => addStationInstructionField(station.title, station.content));
                    } else if (hasGeneralInstructions) {
                        document.querySelector('input[name="instruction-type"][value="general"]').checked = true;
                        generalInstructionsSection.classList.remove('hidden');
                        stationInstructionsSection.classList.add('hidden');
                        activityToEdit.generalInstructions.forEach(instruction => addGeneralInstructionField(instruction));
                    } else {
                        // Default to general instructions if neither is present or has content
                        document.querySelector('input[name="instruction-type"][value="general"]').checked = true;
                        generalInstructionsSection.classList.remove('hidden');
                        stationInstructionsSection.classList.add('hidden');
                        addGeneralInstructionField(); // Add one empty field
                    }

                } else {
                    // Reset for adding new activity
                    activityFormModalTitle.textContent = 'Add New Activity';
                    activityFormSubmitBtn.textContent = 'Add Activity';
                    activityIdInput.value = ''; // Clear hidden ID
                    document.querySelector('input[name="instruction-type"][value="general"]').checked = true; // Default to general
                    generalInstructionsSection.classList.remove('hidden');
                    stationInstructionsSection.classList.add('hidden');
                    generalInstructionsContainer.innerHTML = '';
                    stationInstructionsContainer.innerHTML = '';
                    materialsContainer.innerHTML = '';
                    addGeneralInstructionField(); // Add one default general instruction
                    addMaterialField(); // Add one default material field
                }

                activityFormModal.classList.add('active'); // Show the modal
            }


            // Close Add/Edit Activity Modal via 'X' button
            closeActivityFormModalBtn.addEventListener('click', () => {
                activityFormModal.classList.remove('active');
            });
            // Close Add/Edit Activity Modal via outside click on the overlay
            activityFormModal.addEventListener('click', (e) => {
                if (e.target === activityFormModal) {
                    activityFormModal.classList.remove('active');
                }
            });

            // Event listener for instruction type radio buttons
            instructionTypeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'general') {
                        generalInstructionsSection.classList.remove('hidden');
                        stationInstructionsSection.classList.add('hidden');
                        // Ensure at least one field if switching to general and it's empty
                        if (generalInstructionsContainer.children.length === 0) {
                            addGeneralInstructionField();
                        }
                    } else {
                        generalInstructionsSection.classList.add('hidden');
                        stationInstructionsSection.classList.remove('hidden');
                        // Ensure at least one field if switching to station and it's empty
                        if (stationInstructionsContainer.children.length === 0) {
                            addStationInstructionField();
                        }
                    }
                });
            });

            /**
             * Adds a new general instruction input field to the Add Activity form.
             * @param {string} [value=''] - The initial value for the textarea.
             */
            function addGeneralInstructionField(value = '') {
                const div = document.createElement('div');
                div.className = 'instruction-item flex items-center gap-2';
                div.innerHTML = `
                    <textarea name="generalInstructions[]" rows="2" required class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., **Overall Setup:** Designate 5-7 distinct stations... (Markdown supported)">${value}</textarea>
                    <button type="button" class="remove-instruction-btn text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                `;
                generalInstructionsContainer.appendChild(div);
                addRemoveEventListeners(); // Re-add listeners for new dynamic fields
            }

            /**
             * Adds a new station instruction input field to the Add Activity form.
             * @param {string} [title=''] - The initial title for the station.
             * @param {string} [content=''] - The initial content for the station.
             */
            function addStationInstructionField(title = '', content = '') {
                const div = document.createElement('div');
                div.className = 'station-item border-b pb-4 mb-4 last:border-b-0 last:pb-0 last:mb-0';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-semibold text-stone-700">Station Details</h4>
                        <button type="button" class="remove-station-btn text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                    </div>
                    <label class="block text-stone-700 text-sm font-medium mb-1">Station Title</label>
                    <input type="text" name="stationTitles[]" required class="w-full p-2 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500 mb-2" placeholder="e.g., Station 1: Balloon Defying Gravity" value="${title}">
                    <label class="block text-stone-700 text-sm font-medium mb-1">Station Content</label>
                    <textarea name="stationContents[]" rows="4" required class="w-full p-2 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Setup: Clear an open space... (Markdown supported)"></textarea>
                `;
                // Explicitly set the textarea's value
                const textarea = div.querySelector('textarea[name="stationContents[]"]');
                if (textarea) {
                    textarea.value = content;
                }
                stationInstructionsContainer.appendChild(div);
                addRemoveEventListeners(); // Re-add listeners for new dynamic fields
            }


            /**
             * Adds a new material input field to the Add Activity form.
             * @param {string} [value=''] - The initial value for the input.
             */
            function addMaterialField(value = '') {
                const div = document.createElement('div');
                div.className = 'material-item flex items-center gap-2';
                div.innerHTML = `
                    <input type="text" name="materials[]" class="w-full p-3 border border-stone-300 rounded-md focus:ring-teal-500 focus:border-teal-500" placeholder="e.g., Water Guns (14)" value="${value}">
                    <button type="button" class="remove-material-btn text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                `;
                materialsContainer.appendChild(div);
                addRemoveEventListeners(); // Re-add listeners for new dynamic fields
            }

            /**
             * Attaches event listeners to dynamically added 'remove' buttons
             * for instruction and material fields.
             */
            function addRemoveEventListeners() {
                // For general instruction fields
                document.querySelectorAll('.remove-instruction-btn').forEach(button => {
                    button.onclick = (e) => {
                        // Ensure at least one instruction field remains if general instructions are active
                        if (document.querySelector('input[name="instruction-type"][value="general"]').checked && generalInstructionsContainer.children.length > 1) {
                            e.target.closest('.instruction-item').remove();
                        } else if (document.querySelector('input[name="instruction-type"][value="general"]').checked) {
                            console.warn("Cannot remove the last general instruction field.");
                        }
                    };
                });
                // For station instruction fields
                document.querySelectorAll('.remove-station-btn').forEach(button => {
                    button.onclick = (e) => {
                        // Ensure at least one station field remains if station instructions are active
                        if (document.querySelector('input[name="instruction-type"][value="station"]').checked && stationInstructionsContainer.children.length > 1) {
                            e.target.closest('.station-item').remove();
                        } else if (document.querySelector('input[name="instruction-type"][value="station"]').checked) {
                            console.warn("Cannot remove the last station instruction field.");
                        }
                    };
                });
                // For material fields
                document.querySelectorAll('.remove-material-btn').forEach(button => {
                    button.onclick = (e) => {
                        // Allow removing all material fields
                        e.target.closest('.material-item').remove();
                    };
                });
            }

            // Add event listeners for "Add" buttons in the form
            addGeneralInstructionBtn.addEventListener('click', () => addGeneralInstructionField());
            addStationInstructionBtn.addEventListener('click', () => addStationInstructionField());
            addMaterialBtn.addEventListener('click', () => addMaterialField());

            // Initial call to add default fields when the form is first loaded/opened for adding
            addGeneralInstructionField();
            addMaterialField();

            // --- Soft Delete and Permanent Delete Logic ---

            /**
             * Marks an activity as deleted (soft delete) in Firestore.
             * @param {string} gameId - The ID of the activity to mark as deleted.
             */
            async function softDeleteActivity(gameId) {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not authenticated. Cannot soft delete activity.");
                    return;
                }
                try {
                    // Update the 'deleted' field to true for the specified activity
                    const activityRef = doc(db, `artifacts/${appId}/public/data/activities`, gameId);
                    await updateDoc(activityRef, { deleted: true });
                    console.log("Activity soft-deleted successfully:", gameId);
                    modal.classList.remove('active'); // Close the details modal
                    // The onSnapshot listener will automatically update the UI
                } catch (error) {
                    console.error("Error soft-deleting activity:", error);
                }
            }

            // Event listener for the "Move to Trash" button
            moveToTrashBtn.addEventListener('click', (e) => {
                const gameId = e.target.dataset.gameId;
                if (gameId) {
                    softDeleteActivity(gameId);
                }
            });

            /**
             * Updates the count of deleted activities displayed on the dashboard.
             */
            function updateDeletedCount() {
                const deletedCount = allActivities.filter(g => g.deleted).length;
                deletedCountSpan.textContent = deletedCount;
            }

            /**
             * Displays all activities that have been soft-deleted in a modal.
             */
            function showDeletedActivities() {
                deletedActivitiesList.innerHTML = ''; // Clear previous list
                const deletedActivities = allActivities.filter(g => g.deleted);

                if (deletedActivities.length === 0) {
                    deletedActivitiesList.innerHTML = '<p class="text-stone-600">No activities in trash.</p>';
                    deletedActivitiesModal.classList.add('active');
                    return;
                }

                deletedActivities.forEach(game => {
                    const deletedItem = document.createElement('div');
                    deletedItem.className = 'bg-stone-100 p-4 rounded-lg flex justify-between items-center shadow-sm';
                    deletedItem.innerHTML = `
                        <span class="font-semibold text-stone-800">${game.name}</span>
                        <div class="flex gap-2">
                            <button data-game-id="${game.id}" class="restore-activity-btn bg-emerald-500 text-white font-semibold py-1 px-3 rounded-md hover:bg-emerald-600 transition-colors text-sm">Restore</button>
                            <button data-game-id="${game.id}" class="permanent-delete-btn bg-red-600 text-white font-semibold py-1 px-3 rounded-md hover:bg-red-700 transition-colors text-sm">Delete Permanently</button>
                        </div>
                    `;
                    deletedActivitiesList.appendChild(deletedItem);
                });

                // Attach event listeners to the dynamically created buttons
                deletedActivitiesList.querySelectorAll('.restore-activity-btn').forEach(button => {
                    button.addEventListener('click', (e) => restoreActivity(e.target.dataset.gameId));
                });
                deletedActivitiesList.querySelectorAll('.permanent-delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => confirmPermanentDelete(e.target.dataset.gameId));
                });

                deletedActivitiesModal.classList.add('active'); // Show the modal
            }

            /**
             * Restores a soft-deleted activity (sets 'deleted' to false).
             * @param {string} gameId - The ID of the activity to restore.
             */
            async function restoreActivity(gameId) {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not authenticated. Cannot restore activity.");
                    return;
                }
                try {
                    const activityRef = doc(db, `artifacts/${appId}/public/data/activities`, gameId);
                    await updateDoc(activityRef, { deleted: false });
                    console.log("Activity restored successfully:", gameId);
                    deletedActivitiesModal.classList.remove('active'); // Close the deleted activities modal
                    // The onSnapshot listener will automatically update the UI
                } catch (error) {
                    console.error("Error restoring activity:", error);
                }
            }

            /**
             * Opens the confirmation modal for permanent deletion.
             * @param {string} gameId - The ID of the activity to permanently delete.
             */
            function confirmPermanentDelete(gameId) {
                activityToDeleteId = gameId; // Store the ID
                confirmationModal.classList.add('active'); // Show confirmation modal
            }

            /**
             * Permanently deletes an activity from Firestore.
             * @param {string} gameId - The ID of the activity to delete.
             */
            async function permanentDeleteActivity(gameId) {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not authenticated. Cannot permanently delete activity.");
                    return;
                }
                try {
                    // Delete the document from Firestore
                    await deleteDoc(doc(db, `artifacts/${appId}/public/data/activities`, gameId));
                    console.log("Activity permanently deleted successfully:", gameId);
                    confirmationModal.classList.remove('active'); // Close confirmation modal
                    deletedActivitiesModal.classList.remove('active'); // Close deleted activities modal
                    // The onSnapshot listener will automatically update the UI
                } catch (error) {
                    console.error("Error permanently deleting activity:", error);
                }
            }

            // Event listeners for deleted activities modal and confirmation modal
            viewDeletedActivitiesBtn.addEventListener('click', showDeletedActivities);
            closeDeletedActivitiesModalBtn.addEventListener('click', () => {
                deletedActivitiesModal.classList.remove('active');
            });
            deletedActivitiesModal.addEventListener('click', (e) => {
                if (e.target === deletedActivitiesModal) {
                    deletedActivitiesModal.classList.remove('active');
                }
            });

            confirmPermanentDeleteBtn.addEventListener('click', () => {
                if (activityToDeleteId) {
                    permanentDeleteActivity(activityToDeleteId);
                    activityToDeleteId = null; // Clear the stored ID
                }
            });
            cancelPermanentDeleteBtn.addEventListener('click', () => {
                confirmationModal.classList.remove('active');
                activityToDeleteId = null; // Clear the stored ID
            });
            confirmationModal.addEventListener('click', (e) => {
                if (e.target === confirmationModal) {
                    confirmationModal.classList.remove('active');
                    activityToDeleteId = null;
                }
            });

            // --- Populate Initial Games Logic ---
            populateInitialGamesBtn.addEventListener('click', async () => {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not authenticated. Cannot populate initial games.");
                    return;
                }

                try {
                    const activitiesCollectionRef = collection(db, `artifacts/${appId}/public/data/activities`);
                    // Check if the collection is empty before populating
                    const existingDocs = await getDocs(activitiesCollectionRef);
                    if (existingDocs.empty) {
                        for (const game of initialGamesData) {
                            // Use setDoc with a specific ID to avoid duplicates if re-run
                            await setDoc(doc(activitiesCollectionRef, game.id), game);
                        }
                        console.log("Initial games populated successfully!");
                        // The onSnapshot listener will automatically update the UI
                    } else {
                        console.log("Activities collection is not empty. Skipping initial game population.");
                    }
                } catch (error) {
                    console.error("Error populating initial games:", error);
                }
            });

            // --- Collapsible Sections Logic ---
            function setupCollapsible(toggleElement, contentElement, iconElement) {
                toggleElement.addEventListener('click', () => {
                    contentElement.classList.toggle('collapsed');
                    iconElement.classList.toggle('collapsed');
                });
            }

            // Setup for Leader Resources
            setupCollapsible(leaderResourcesToggle, leaderResourcesContent, leaderResourcesCollapseIcon);
            // Setup for Activity Management Instructions
            setupCollapsible(activityManagementToggle, activityManagementContent, activityManagementCollapseIcon);
            // Setup for Calendar Instructions
            setupCollapsible(calendarInstructionsToggle, calendarInstructionsContent, calendarInstructionsCollapseIcon);

            // --- Calendar Logic ---

            let scheduledActivities = {}; // Stores scheduled activities: { 'day-timeSlot-slotCategory': { activityId: '...', activityName: '...' } }

            /**
             * Renders the calendar grid based on the `calendarGridStructure` and `scheduleDataFromPDF`.
             * Populates slots with pre-defined team rotations and dynamically scheduled activities.
             */
            function renderCalendarGrid() {
                const calendarGridElement = document.querySelector('.calendar-grid');
                calendarGridElement.innerHTML = ''; // Clear existing grid

                calendarGridStructure.forEach(cell => {
                    const div = document.createElement('div');
                    div.classList.add('calendar-cell'); // General class for all cells

                    if (cell.type === 'header') {
                        div.classList.add('calendar-header');
                        div.innerHTML = cell.label;
                        if (cell.colspan) {
                            div.style.gridColumn = `span ${cell.colspan}`;
                        }
                    } else if (cell.type === 'time-slot') {
                        div.classList.add('calendar-time-slot');
                        div.innerHTML = cell.label;
                    } else if (cell.type === 'activity-slot') {
                        div.classList.add('calendar-slot');
                        div.dataset.day = cell.day;
                        div.dataset.timeSlot = cell.timeSlot;
                        div.dataset.slotCategory = cell.slotCategory;
                        
                        // Add droppable/non-droppable class
                        if (cell.isDroppable) {
                            div.classList.add('droppable');
                        } else {
                            div.classList.add('non-droppable');
                        }

                        // Handle colspan for special slots like 'CAMP CARNIVAL'
                        if (cell.colspan) {
                            div.style.gridColumn = `span ${cell.colspan}`;
                            div.innerHTML = `<span class="font-bold text-teal-800 text-lg">${cell.slotCategory}</span>`;
                        } else {
                            // Populate with PDF data (team rotations) if available and slot is non-droppable
                            const pdfData = scheduleDataFromPDF[cell.day]?.[cell.timeSlot]?.[cell.slotCategory];
                            if (pdfData) {
                                // Split team names and apply specific classes for coloring
                                const teamNames = pdfData.split(',').map(team => {
                                    const trimmedTeam = team.trim();
                                    const teamClass = teamColors[trimmedTeam] || ''; // Get the CSS class for the team
                                    return `<span class="${teamClass}">${trimmedTeam}</span>`;
                                }).join(', ');
                                div.innerHTML = teamNames;
                            }
                            
                            // Check if an activity is scheduled for this slot
                            const slotKey = `${cell.day}-${cell.timeSlot}-${cell.slotCategory}`;
                            if (scheduledActivities[slotKey]) {
                                const scheduled = scheduledActivities[slotKey];
                                const activityName = scheduled.activityName;
                                const activityId = scheduled.activityId;
                                div.innerHTML = `
                                    <div class="scheduled-activity-item" data-activity-id="${activityId}" data-day="${cell.day}" data-time-slot="${cell.timeSlot}" data-slot-category="${cell.slotCategory}">
                                        ${activityName}
                                        <button class="remove-scheduled-activity" data-activity-id="${activityId}" data-day="${cell.day}" data-time-slot="${cell.timeSlot}" data-slot-category="${cell.slotCategory}">&times;</button>
                                    </div>
                                `;
                                // If the slot is droppable and now has an activity, make it non-droppable for new drops
                                div.classList.remove('droppable', 'highlight-drop', 'invalid-drop');
                                div.classList.add('non-droppable');
                            }
                        }
                    }
                    calendarGridElement.appendChild(div);
                });
                // Re-attach remove listeners for newly rendered scheduled items
                setupRemoveScheduledActivityListeners();
                updateCalendarSlotHighlights(); // Ensure highlights are correct after re-render
            }

            /**
             * Sets up click listeners for droppable calendar slots to add scheduled activities.
             */
            function setupCalendarClickListeners() {
                document.querySelectorAll('.calendar-slot.droppable').forEach(slot => {
                    slot.addEventListener('click', async () => {
                        if (selectedActivityForSchedule) {
                            const day = slot.dataset.day;
                            const timeSlot = slot.dataset.timeSlot;
                            const slotCategory = slot.dataset.slotCategory;

                            // Validate if the selected activity type matches the slot category
                            const mappedActivityTypeForSlot = selectedActivityForSchedule.type === 'Field Game' ? 'FIELD' : selectedActivityForSchedule.type === 'Team Time' ? 'TEAM TIME' : null;

                            if (mappedActivityTypeForSlot === slotCategory) {
                                // Add the activity to the schedule in Firestore
                                await addScheduledActivity(day, timeSlot, slotCategory, selectedActivityForSchedule.id, selectedActivityForSchedule.name);
                                // Deselect the activity after scheduling
                                toggleActivitySelection(selectedActivityForSchedule.id);
                            } else {
                                console.warn(`Cannot place ${selectedActivityForSchedule.type} in a ${slotCategory} slot.`);
                                // Optionally, provide visual feedback for invalid drop
                                slot.classList.add('invalid-drop');
                                setTimeout(() => slot.classList.remove('invalid-drop'), 1000);
                            }
                        } else {
                            console.log("No activity selected for scheduling.");
                        }
                    });
                });
            }

            /**
             * Adds a scheduled activity to Firestore.
             * @param {string} day
             * @param {string} timeSlot
             * @param {string} slotCategory
             * @param {string} activityId
             * @param {string} activityName
             */
            async function addScheduledActivity(day, timeSlot, slotCategory, activityId, activityName) {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not authenticated. Cannot add scheduled activity.");
                    return;
                }
                try {
                    const scheduledActivitiesCollectionRef = collection(db, `artifacts/${appId}/public/data/scheduledActivities`);
                    const docId = `${day}-${timeSlot}-${slotCategory}`; // Unique ID for the schedule slot
                    await setDoc(doc(scheduledActivitiesCollectionRef, docId), {
                        day,
                        timeSlot,
                        slotCategory,
                        activityId,
                        activityName,
                        timestamp: new Date() // Add a timestamp for potential ordering/tracking
                    });
                    console.log("Activity scheduled successfully:", activityName, "at", docId);
                } catch (error) {
                    console.error("Error adding scheduled activity:", error);
                }
            }

            /**
             * Removes a scheduled activity from Firestore.
             * @param {string} day
             * @param {string} timeSlot
             * @param {string} slotCategory
             */
            async function removeScheduledActivity(day, timeSlot, slotCategory) {
                if (!db || !userId) {
                    console.error("Firestore not initialized or user not authenticated. Cannot remove scheduled activity.");
                    return;
                }
                try {
                    const scheduledActivitiesCollectionRef = collection(db, `artifacts/${appId}/public/data/scheduledActivities`);
                    const docId = `${day}-${timeSlot}-${slotCategory}`;
                    await deleteDoc(doc(scheduledActivitiesCollectionRef, docId));
                    console.log("Scheduled activity removed successfully from:", docId);
                } catch (error) {
                    console.error("Error removing scheduled activity:", error);
                }
            }

            /**
             * Sets up real-time listener for scheduled activities from Firestore.
             */
            function listenForScheduledActivities() {
                if (!db) {
                    console.warn("Firestore not ready for listening to scheduled activities.");
                    return;
                }
                const scheduledActivitiesCollectionRef = collection(db, `artifacts/${appId}/public/data/scheduledActivities`);
                onSnapshot(scheduledActivitiesCollectionRef, (snapshot) => {
                    scheduledActivities = {}; // Reset
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const docId = `${data.day}-${data.timeSlot}-${data.slotCategory}`;
                        scheduledActivities[docId] = {
                            activityId: data.activityId,
                            activityName: data.activityName
                        };
                    });
                    renderCalendarGrid(); // Re-render the calendar with updated scheduled activities
                }, (error) => {
                    console.error("Error fetching scheduled activities:", error);
                });
            }

            /**
             * Attaches event listeners to the 'x' buttons on scheduled activity items.
             */
            function setupRemoveScheduledActivityListeners() {
                document.querySelectorAll('.remove-scheduled-activity').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent click from bubbling to the parent slot
                        const day = e.target.dataset.day;
                        const timeSlot = e.target.dataset.timeSlot;
                        const slotCategory = e.target.dataset.slotCategory;
                        removeScheduledActivity(day, timeSlot, slotCategory);
                    });
                });
            }

            // Initial render and chart update (will be updated by Firebase listener if successful)
            renderCalendarGrid(); // Initial render of the empty calendar grid
        });
    </script>
</body>
</html>
